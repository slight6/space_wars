<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Explorer - Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        .game-bg {
            background: linear-gradient(to bottom, #0f0f23, #1a1a2e, #16213e);
            min-height: 100vh;
        }
        .chat-tab {
            transition: all 0.3s ease;
        }
        .chat-tab.flashing {
            animation: flash 1s infinite;
        }
        @keyframes flash {
            0%, 100% { background-color: #3B82F6; }
            50% { background-color: #EF4444; }
        }
    </style>
</head>
<body class="game-bg text-white" x-data="gameApp()">
    <!-- Header -->
    <header class="bg-gray-900 bg-opacity-80 backdrop-blur-sm border-b border-gray-700 px-6 py-4">
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold">üöÄ Space Explorer</h1>
            </div>
            <div class="flex items-center space-x-6">
                <button @click="logout()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md text-sm transition-colors">
                    Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Stats Bar -->
    <div class="bg-gray-800 bg-opacity-90 backdrop-blur-sm border-b border-gray-600 px-6 py-3">
        <div class="flex flex-wrap items-center justify-between gap-4 text-sm">
            <!-- Left Side Stats -->
            <div class="flex flex-wrap items-center gap-6">
                <div class="flex flex-col">
                    <div class="flex items-center space-x-2">
                        <span class="text-gray-400">Pilot:</span>
                        <span class="text-blue-400 font-semibold" x-text="player.username"></span>
                    </div>
                    <div class="flex items-center space-x-2 mt-1">
                        <span class="text-gray-400">Rank:</span>
                        <span class="text-blue-400" x-text="player.rank || 'novice'"></span>
                    </div>
                </div>
                <div class="flex flex-col">
                    <div class="flex items-center space-x-2">
                        <span class="text-gray-400">Location:</span>
                        <span class="text-green-400" x-text="player.currentLocation || 'Nexus Station'"></span>
                    </div>
                    <div class="flex items-center space-x-2 mt-1">
                        <span class="text-gray-400">Subsection:</span>
                        <span class="text-green-400" x-text="player.currentSubsection || 'main'"></span>
                    </div>
                </div>
                <div class="flex flex-col">
                    <div class="flex items-center space-x-2">
                        <span class="text-gray-400">Turns:</span>
                        <span class="text-cyan-400 font-mono" x-text="`${player.turnsRemaining || 25}/${player.turnsMax || 100}`"></span>
                    </div>
                    <div class="flex items-center space-x-2 mt-1">
                        <span class="text-gray-400">Awareness:</span>
                        <span class="text-cyan-400 font-mono" x-text="`${player.awareness || 100}/${player.awarenessMax || 100}`"></span>
                    </div>
                </div>
                <div class="flex flex-col">
                    <div class="flex items-center space-x-2">
                        <span class="text-gray-400">Cargo:</span>
                        <span class="text-purple-400 font-mono" x-text="`${player.cargoUsed || 0}/${player.cargoCapacity || 100}`"></span>
                    </div>
                    <div class="flex items-center space-x-2 mt-1">
                        <span class="text-gray-400">Crew:</span>
                        <span class="text-purple-400 font-mono" x-text="`${player.crewCurrent || 1}/${player.crewMax || 5}`"></span>
                    </div>
                </div>
            </div>

            <!-- Center Stats -->
            <div class="flex flex-wrap items-center gap-6">
                <div class="flex flex-col">
                    <div class="flex items-center space-x-2">
                        <span class="text-gray-400">Credits:</span>
                        <span class="text-yellow-400 font-mono" x-text="player.credits.toLocaleString()"></span>
                    </div>
                    <div class="flex items-center space-x-2 mt-1">
                        <span class="text-gray-400">Fuel:</span>
                        <span class="text-blue-400" x-text="`${player.fuel || 67}%`"></span>
                    </div>
                </div>
                <div class="flex flex-col">
                    <div class="flex items-center space-x-2">
                        <span class="text-gray-400">Level:</span>
                        <span class="text-green-400" x-text="player.level"></span>
                    </div>
                    <div class="flex items-center space-x-2 mt-1">
                        <span class="text-gray-400">Experience:</span>
                        <span class="text-orange-400" x-text="`${player.experience || 0} XP`"></span>
                    </div>
                </div>
            </div>

            <!-- Right Side Stats -->
            <div class="flex flex-wrap items-center gap-6">
                <div class="flex items-center space-x-2">
                    <span class="text-gray-400">XP Progress:</span>
                    <div class="w-24 bg-gray-700 rounded-full h-2">
                        <div 
                            class="bg-orange-400 h-2 rounded-full transition-all duration-300" 
                            :style="`width: ${((player.experience || 0) % 100)}%`">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Status Bar -->
    <div class="bg-gray-700 bg-opacity-80 backdrop-blur-sm border-b border-gray-600 px-6 py-3">
        <div class="mx-auto" style="width: 90%;">
            <div class="flex items-center justify-center gap-4">
                <div class="flex items-center space-x-3">
                    <span class="text-gray-300 text-sm font-medium">Current Action:</span>
                    <span class="text-cyan-400 text-sm" x-text="player.currentAction || 'none'"></span>
                </div>
                <div class="flex-1 max-w-md">
                    <div class="w-full bg-gray-600 rounded-full h-3 overflow-hidden">
                        <div 
                            class="h-3 rounded-full transition-all duration-500 ease-in-out"
                            :class="player.currentAction && player.currentAction !== 'none' ? 'bg-blue-400' : 'bg-gray-500'"
                            :style="`width: ${player.actionProgress || 0}%`">
                        </div>
                    </div>
                </div>
                <div class="text-xs text-gray-400" x-text="player.currentAction && player.currentAction !== 'none' ? `${player.actionProgress || 0}%` : ''"></div>
            </div>
        </div>
    </div>

    <!-- Main Game Area -->
    <main class="container mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left Panel - Ship Options -->
            <div class="space-y-6">
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg p-6 border border-gray-700">
                    <h2 class="text-xl font-bold mb-4">Ship Options</h2>
                    <div class="space-y-3">
                        <button @click="window.location.href='inventory.html'" class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üì¶ View Inventory
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üîç Scan Surrounding Area
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üåå Investigate Asteroid Belt
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üåç Scan Nearby Planets
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üõ∞Ô∏è Scan Space Stations
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üöÄ Scan Other Ships
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            ‚≠ê Analyze Local Star
                        </button>
                    </div>
                </div>

                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg p-6 border border-gray-700">
                    <h2 class="text-xl font-bold mb-4">üìä Ship Status</h2>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Hull Integrity</span>
                                <span>85%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2">
                                <div class="bg-green-400 h-2 rounded-full" style="width: 85%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Fuel</span>
                                <span>67%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2">
                                <div class="bg-blue-400 h-2 rounded-full" style="width: 67%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Energy</span>
                                <span>92%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2">
                                <div class="bg-yellow-400 h-2 rounded-full" style="width: 92%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Location Options -->
            <div class="space-y-6">
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg p-6 border border-gray-700">
                    <h2 class="text-xl font-bold mb-4">Location Options</h2>
                    <div class="space-y-3">
                        <button @click="window.location.href='shipyard.html'" class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üè≠ Visit Shipyard
                        </button>
                        <button @click="window.location.href='torpedo-launch.html'" class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors border border-red-600 text-red-400">
                            üöÄ Torpedo Launch Center
                        </button>
                        <button @click="window.location.href='marketplace.html'" class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üõí Browse Marketplace
                        </button>
                        <button @click="window.location.href='trade-center.html'" class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üè¶ Trade Center
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üî¨ Research Lab
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üè≠ Manufacturing
                        </button>
                        <button @click="window.location.href='specialists.html'" class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üë• State Specialists
                        </button>
                        <button @click="window.location.href='mission-log.html'" class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üìã Mission Log
                        </button>
                        <button @click="window.location.href='system-map.html'" class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üó∫Ô∏è System Map
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üì° Communications
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üç∫ Visit Tavern
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üèõÔ∏è Government Facilities
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üìã View Solar System Map
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üë• Talk to Locals
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            üì∞ Check Local News
                        </button>
                        <button class="w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors">
                            ‚öîÔ∏è Buy Equipment & Gear
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Chat System -->
    <div class="fixed bottom-0 right-4 z-50 flex flex-col items-end">
        <!-- Chat Panel (positioned above tab when open) -->
        <div 
            x-show="chatOpen"
            x-transition:enter="transition ease-out duration-400"
            x-transition:enter-start="opacity-0 transform translate-y-6 scale-95"
            x-transition:enter-end="opacity-100 transform translate-y-0 scale-100"
            x-transition:leave="transition ease-in duration-250"
            x-transition:leave-start="opacity-100 transform translate-y-0 scale-100"
            x-transition:leave-end="opacity-0 transform translate-y-6 scale-95"
            class="bg-gray-900 bg-opacity-95 backdrop-blur-sm border border-gray-700 border-b-0 rounded-lg rounded-b-none shadow-2xl"
            style="width: 400px; height: 300px; transform-origin: bottom right;">
            
            <!-- Chat Header - Fully Clickable -->
            <div @click="toggleChat()" class="flex justify-between items-center p-3 border-b border-gray-700 bg-blue-600 rounded-t-lg cursor-pointer hover:bg-blue-700 transition-colors">
                <h3 class="text-sm font-semibold text-white">Global Chat</h3>
                <button class="text-white hover:text-gray-200 pointer-events-none">‚úï</button>
            </div>

            <!-- Chat Messages -->
            <div class="h-48 overflow-y-auto p-3 space-y-2" x-ref="chatMessages">
                <template x-for="message in chatMessages" :key="message.id">
                    <div class="text-sm">
                        <span class="text-blue-400 font-semibold" x-text="message.username"></span>:
                        <span class="text-gray-300" x-text="message.text"></span>
                        <div class="text-xs text-gray-500" x-text="message.timestamp"></div>
                    </div>
                </template>
            </div>

            <!-- Chat Input -->
            <div class="p-3 border-t border-gray-700">
                <form @submit.prevent="sendMessage()" class="flex space-x-2">
                    <input 
                        type="text" 
                        x-model="newMessage"
                        placeholder="Send a message to the fleet..."
                        class="flex-1 px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                    <button 
                        type="submit"
                        :disabled="!newMessage.trim()"
                        class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 px-3 py-2 rounded-md transition-colors">
                        Send
                    </button>
                </form>
            </div>
        </div>

        <!-- Chat Tab (hidden when chat is open) -->
        <div 
            x-show="!chatOpen"
            x-transition:enter="transition ease-in duration-200"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-out duration-200"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            @click="toggleChat()"
            :class="{ 'flashing': hasNewMessage }"
            class="chat-tab bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-t-lg cursor-pointer shadow-lg flex items-center space-x-2">
            <span>üí¨</span>
            <span>Chat</span>
            <span x-show="hasNewMessage" class="bg-red-500 text-xs px-2 py-1 rounded-full">!</span>
        </div>
    </div>

    <script>
        function gameApp() {
            return {
                player: {},
                chatOpen: false,
                hasNewMessage: false,
                newMessage: '',
                chatMessages: [],
                
                init() {
                    // Check if user is logged in
                    const currentPlayer = localStorage.getItem('currentPlayer');
                    if (!currentPlayer) {
                        window.location.href = 'index.html';
                        return;
                    }
                    
                    this.player = JSON.parse(currentPlayer);
                    
                    // Initialize additional player stats if they don't exist
                    if (!this.player.rank) this.player.rank = 'novice';
                    if (!this.player.currentLocation) this.player.currentLocation = 'Nexus Station';
                    if (!this.player.currentSubsection) this.player.currentSubsection = 'main';
                    if (!this.player.turnsRemaining) this.player.turnsRemaining = 25;
                    if (!this.player.turnsMax) this.player.turnsMax = 100;
                    if (!this.player.awareness) this.player.awareness = 100;
                    if (!this.player.awarenessMax) this.player.awarenessMax = 100;
                    if (!this.player.cargoUsed) this.player.cargoUsed = 0;
                    if (!this.player.cargoCapacity) this.player.cargoCapacity = 100;
                    if (!this.player.crewCurrent) this.player.crewCurrent = 1;
                    if (!this.player.crewMax) this.player.crewMax = 5;
                    if (!this.player.fuel) this.player.fuel = 67;
                    if (!this.player.experience) this.player.experience = 0;
                    if (!this.player.currentAction) this.player.currentAction = 'none';
                    if (!this.player.actionProgress) this.player.actionProgress = 0;
                    
                    // Save updated player data
                    localStorage.setItem('currentPlayer', JSON.stringify(this.player));
                    
                    this.loadChatMessages();
                    
                    // Simulate receiving messages from other players
                    this.simulateIncomingMessages();
                },
                
                logout() {
                    localStorage.removeItem('currentPlayer');
                    window.location.href = 'index.html';
                },
                
                toggleChat() {
                    this.chatOpen = !this.chatOpen;
                    if (this.chatOpen) {
                        this.hasNewMessage = false;
                        this.$nextTick(() => {
                            this.scrollChatToBottom();
                        });
                    }
                },
                
                sendMessage() {
                    if (!this.newMessage.trim()) return;
                    
                    const message = {
                        id: Date.now(),
                        username: this.player.username,
                        text: this.newMessage.trim(),
                        timestamp: new Date().toLocaleTimeString()
                    };
                    
                    this.chatMessages.push(message);
                    this.saveChatMessages();
                    this.newMessage = '';
                    
                    this.$nextTick(() => {
                        this.scrollChatToBottom();
                    });
                },
                
                loadChatMessages() {
                    const saved = localStorage.getItem('chatMessages');
                    this.chatMessages = saved ? JSON.parse(saved) : [];
                },
                
                saveChatMessages() {
                    localStorage.setItem('chatMessages', JSON.stringify(this.chatMessages));
                },
                
                scrollChatToBottom() {
                    if (this.$refs.chatMessages) {
                        this.$refs.chatMessages.scrollTop = this.$refs.chatMessages.scrollHeight;
                    }
                },
                
                simulateIncomingMessages() {
                    // Simulate messages from other players every 30-60 seconds
                    const messages = [
                        "Just discovered a new mineral vein on Kepler-438b!",
                        "Anyone want to team up for a deep space expedition?",
                        "The asteroid belt near Proxima is rich with rare metals",
                        "My ship's reactor is running low, heading back to station",
                        "Found some ancient alien artifacts in the Vega system",
                        "Trading rare crystals for fuel cells at the station"
                    ];
                    
                    const usernames = ["StarCaptain92", "VoidExplorer", "CosmicMiner", "NebulaRunner", "AstroTrader"];
                    
                    setInterval(() => {
                        if (Math.random() < 0.3) { // 30% chance every interval
                            const message = {
                                id: Date.now(),
                                username: usernames[Math.floor(Math.random() * usernames.length)],
                                text: messages[Math.floor(Math.random() * messages.length)],
                                timestamp: new Date().toLocaleTimeString()
                            };
                            
                            this.chatMessages.push(message);
                            this.saveChatMessages();
                            
                            if (!this.chatOpen) {
                                this.hasNewMessage = true;
                            } else {
                                this.$nextTick(() => {
                                    this.scrollChatToBottom();
                                });
                            }
                        }
                    }, 45000); // Check every 45 seconds
                }
            }
        }
    </script>
</body>
</html>
