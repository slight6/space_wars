<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Explorer - Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="ship-status-bar.js"></script>
    <script src="unified-header.js"></script>
    <script src="universal-footer.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        .game-bg {
            background: linear-gradient(to bottom, #0f0f23, #1a1a2e, #16213e);
            min-height: 100vh;
        }
    </style>
</head>
<body class="game-bg text-white" x-data="inventoryApp()">
    <!-- Header -->
    <header class="bg-gray-900 bg-opacity-80 backdrop-blur-sm border-b border-gray-700 px-6 py-4">
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <button @click="goBack()" class="bg-gray-600 hover:bg-gray-700 px-3 py-2 rounded-md text-sm transition-colors">
                    ‚Üê Back
                </button>
                <h1 class="text-2xl font-bold">üì¶ Inventory & Stats</h1>
            </div>
            <div class="flex items-center space-x-6">
                <button @click="logout()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md text-sm transition-colors">
                    Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Unified Status Bar -->
    <div class="bg-gray-800 bg-opacity-90 backdrop-blur-sm border-b border-gray-600 px-6 py-3">
        <div class="container mx-auto">
            <div class="flex items-center justify-between">
                <!-- Left Side: Ship and Pilot Information -->
                <div class="flex items-center space-x-6">
                    <!-- Ship Icon and Name -->
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-bold">üöÄ</span>
                        </div>
                        <div>
                            <div class="text-white font-semibold text-sm" x-text="statusBar.getPilotInfo()"></div>
                            <div class="text-blue-400 font-medium text-sm" x-text="statusBar.getCurrentShipLabel()"></div>
                            <div class="text-gray-400 text-xs" x-text="'Location: ' + statusBar.getCurrentLocation()"></div>
                        </div>
                    </div>
                    
                    <!-- Ship Status Indicators -->
                    <div class="hidden md:flex items-center space-x-4 text-sm">
                        <div class="flex items-center space-x-1">
                            <span class="text-gray-400">Hull:</span>
                            <span class="text-cyan-400 font-semibold" x-text="statusBar.getHullIntegrity() + '%'"></span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-gray-400">Shields:</span>
                            <span class="text-purple-400 font-semibold" x-text="statusBar.getShieldStrength() + '%'"></span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-gray-400">Fuel:</span>
                            <span class="text-orange-400 font-semibold" x-text="statusBar.getFuelLevel() + '%'"></span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-gray-400">Power:</span>
                            <span class="text-red-400 font-semibold" x-text="statusBar.getPowerLevel() + '%'"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Right Side: Status and Credits -->
                <div class="text-right">
                    <div class="text-sm font-semibold" :class="statusBar.getSystemStatus().color" x-text="statusBar.getSystemStatus().status"></div>
                    <div class="text-yellow-400 font-mono text-sm" x-text="'Credits: ' + statusBar.getCredits().toLocaleString()"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left Panel - Player Stats -->
            <div class="space-y-6">
                <!-- Basic Stats -->
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg p-6 border border-gray-700">
                    <h2 class="text-xl font-bold mb-4 text-blue-400">üë§ Player Information</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-sm text-gray-400">Pilot Name:</div>
                            <div class="text-blue-400 font-semibold" x-text="player.username"></div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Rank:</div>
                            <div class="text-blue-400" x-text="player.rank || 'Novice'"></div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Level:</div>
                            <div class="text-green-400" x-text="player.level || 1"></div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Experience:</div>
                            <div class="text-orange-400" x-text="`${player.experience || 0} XP`"></div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Credits:</div>
                            <div class="text-yellow-400 font-mono" x-text="player.credits.toLocaleString()"></div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Location:</div>
                            <div class="text-green-400" x-text="player.currentLocation || 'Nexus Station'"></div>
                        </div>
                    </div>
                </div>

                <!-- Ship Stats -->
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg p-6 border border-gray-700">
                    <h2 class="text-xl font-bold mb-4 text-cyan-400">üöÄ Ship Status</h2>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Hull Integrity</span>
                                <span>85%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-3">
                                <div class="bg-green-400 h-3 rounded-full transition-all duration-300" style="width: 85%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Shields</span>
                                <span>78%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-3">
                                <div class="bg-cyan-400 h-3 rounded-full transition-all duration-300" style="width: 78%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Energy</span>
                                <span>92%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-3">
                                <div class="bg-yellow-400 h-3 rounded-full transition-all duration-300" style="width: 92%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Oxygen</span>
                                <span>95%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-3">
                                <div class="bg-blue-300 h-3 rounded-full transition-all duration-300" style="width: 95%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Fuel</span>
                                <span x-text="`${player.fuel || 67}%`"></span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-3">
                                <div class="bg-blue-400 h-3 rounded-full transition-all duration-300" :style="`width: ${player.fuel || 67}%`"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Capacity Stats -->
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg p-6 border border-gray-700">
                    <h2 class="text-xl font-bold mb-4 text-purple-400">üìä Capacity & Resources</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-sm text-gray-400">Cargo Space:</div>
                            <div class="text-purple-400 font-mono" x-text="`${player.cargoUsed || 0}/${player.cargoCapacity || 100}`"></div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Crew:</div>
                            <div class="text-purple-400 font-mono" x-text="`${player.crewCurrent || 1}/${player.crewMax || 5}`"></div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Turns Remaining:</div>
                            <div class="text-cyan-400 font-mono" x-text="`${player.turnsRemaining || 25}/${player.turnsMax || 100}`"></div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Awareness:</div>
                            <div class="text-cyan-400 font-mono" x-text="`${player.awareness || 100}/${player.awarenessMax || 100}`"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Inventory -->
            <div class="space-y-6">
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg p-6 border border-gray-700">
                    <h2 class="text-xl font-bold mb-4 text-green-400">üéí Equipment Inventory</h2>
                    
                    <!-- Inventory Items -->
                    <div class="space-y-3 max-h-96 overflow-y-auto">
                        <template x-for="item in player.inventory" :key="item.id">
                            <div class="bg-gray-800 p-4 rounded-md border border-gray-600 hover:border-gray-500 transition-colors">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-semibold text-white" x-text="item.name"></h4>
                                        <div class="text-sm text-gray-400" x-text="`Quantity: ${item.quantity}`"></div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-yellow-400 text-sm font-mono" x-text="`Value: ${item.sellPrice ? item.sellPrice.toLocaleString() : 'N/A'} CR`"></div>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-300 mb-3" x-text="item.description"></p>
                                <div class="flex justify-between items-center">
                                    <div class="flex space-x-2">
                                        <span class="text-xs px-2 py-1 bg-blue-600 rounded" x-show="item.id.includes('torpedo')">Weapon</span>
                                        <span class="text-xs px-2 py-1 bg-purple-600 rounded" x-show="item.id.includes('cannon')">Weapon</span>
                                        <span class="text-xs px-2 py-1 bg-cyan-600 rounded" x-show="item.id.includes('shield')">Defense</span>
                                        <span class="text-xs px-2 py-1 bg-green-600 rounded" x-show="item.id.includes('cargo')">Upgrade</span>
                                        <span class="text-xs px-2 py-1 bg-orange-600 rounded" x-show="item.id.includes('engine')">Upgrade</span>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button 
                                            @click="useItem(item)"
                                            x-show="canUseItem(item)"
                                            class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-xs transition-colors">
                                            Use
                                        </button>
                                        <button 
                                            @click="sellItem(item)"
                                            class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-xs transition-colors">
                                            Sell
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                        
                        <!-- Empty Inventory Message -->
                        <div x-show="!player.inventory || player.inventory.length === 0" class="text-center py-8">
                            <div class="text-gray-400 text-lg mb-2">üì≠</div>
                            <div class="text-gray-400">Your inventory is empty</div>
                            <div class="text-sm text-gray-500 mt-2">Visit the shipyard to purchase equipment</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg p-6 border border-gray-700">
                    <h2 class="text-xl font-bold mb-4 text-orange-400">‚ö° Quick Actions</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <button @click="goToShipyard()" class="bg-blue-600 hover:bg-blue-700 px-4 py-3 rounded-md text-sm transition-colors">
                            üè≠ Visit Shipyard
                        </button>
                        <button @click="goBack()" class="bg-green-600 hover:bg-green-700 px-4 py-3 rounded-md text-sm transition-colors">
                            üéÆ Back to Game
                        </button>
                        <button class="bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-md text-sm transition-colors">
                            üìä View Statistics
                        </button>
                        <button class="bg-yellow-600 hover:bg-yellow-700 px-4 py-3 rounded-md text-sm transition-colors">
                            üîß Manage Equipment
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        function inventoryApp() {
            return {
                player: {},
                
                init() {
                    // Check if user is logged in
                    const currentPlayer = localStorage.getItem('currentPlayer');
                    if (!currentPlayer) {
                        window.location.href = 'index.html';
                        return;
                    }
                    
                    this.player = JSON.parse(currentPlayer);
                    
                    // Initialize unified status bar
                    initializeStatusBar(this);
                    
                    // Initialize inventory if it doesn't exist
                    if (!this.player.inventory) {
                        this.player.inventory = [];
                    }
                },
                
                goBack() {
                    window.location.href = 'game.html';
                },
                
                goToShipyard() {
                    window.location.href = 'shipyard.html';
                },
                
                logout() {
                    localStorage.removeItem('currentPlayer');
                    window.location.href = 'index.html';
                },
                
                canUseItem(item) {
                    // Define which items can be "used" vs just equipped/installed
                    const usableItems = ['torpedo', 'repair', 'fuel'];
                    return usableItems.some(type => item.id.includes(type));
                },
                
                useItem(item) {
                    if (item.id.includes('torpedo')) {
                        this.showNotification(`${item.name} equipped and ready for combat!`, 'success');
                    } else if (item.id.includes('repair')) {
                        this.showNotification(`${item.name} used - ship systems optimized!`, 'success');
                    } else {
                        this.showNotification(`${item.name} activated!`, 'success');
                    }
                },
                
                sellItem(item) {
                    if (!item.sellPrice) {
                        this.showNotification('This item cannot be sold', 'error');
                        return;
                    }
                    
                    // Add credits
                    this.player.credits += item.sellPrice;
                    
                    // Remove from inventory
                    if (item.quantity > 1) {
                        item.quantity -= 1;
                    } else {
                        const index = this.player.inventory.findIndex(invItem => invItem.id === item.id);
                        this.player.inventory.splice(index, 1);
                    }
                    
                    this.savePlayer();
                    this.showNotification(`Sold ${item.name} for ${item.sellPrice.toLocaleString()} CR`, 'success');
                },
                
                savePlayer() {
                    localStorage.setItem('currentPlayer', JSON.stringify(this.player));
                },
                
                showNotification(message, type = 'success') {
                    Toastify({
                        text: message,
                        duration: 3000,
                        close: true,
                        gravity: "top",
                        position: "right",
                        style: {
                            background: type === 'success' ? "#10B981" : "#EF4444"
                        }
                    }).showToast();
                }
            }
        }
    </script>
</body>
</html>
