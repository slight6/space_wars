<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keldar - Deep Space Trading Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="localStorage-player-manager.js"></script>
    <script src="unified-header.js"></script>
    <style>
        .star-field {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #0f0f23, #1a1a2e, #16213e);
            z-index: -1;
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        .planet {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            animation: rotate 20s linear infinite;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Game Interface Styling */
        .game-panel {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(75, 85, 99, 0.7);
            border-radius: 12px;
            min-height: 400px;
        }
    </style>
</head>
<body class="min-h-screen" x-data="gameApp()">
    <!-- Animated background -->
    <div class="star-field" id="starField"></div>
    
    <!-- Authentication Screen (when not logged in) -->
    <div x-show="!isAuthenticated" class="min-h-screen flex items-center justify-center">
        <div class="relative z-10 w-full max-w-md">
            <!-- Login/Register Form (exact copy of original) -->
            <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg shadow-2xl p-8 border border-gray-700">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold text-white mb-2">🚀 KELDAR</h1>
                    <p class="text-gray-300">Deep Space Trading Game</p>
                </div>
                
                <!-- Toggle between Login/Register -->
                <div class="flex mb-6">
                    <button 
                        @click="showRegister = false" 
                        :class="!showRegister ? 'bg-blue-600 text-white' : 'bg-gray-700 text-gray-300'"
                        class="flex-1 py-2 px-4 rounded-l-lg transition-colors duration-200">
                        Login
                    </button>
                    <button 
                        @click="showRegister = true" 
                        :class="showRegister ? 'bg-blue-600 text-white' : 'bg-gray-700 text-gray-300'"
                        class="flex-1 py-2 px-4 rounded-r-lg transition-colors duration-200">
                        Register
                    </button>
                </div>
                
                <!-- Login Form -->
                <form x-show="!showRegister" @submit.prevent="handleLogin" class="space-y-4">
                    <div>
                        <label for="loginUsername" class="block text-sm font-medium text-gray-300 mb-2">Commander Name</label>
                        <input 
                            type="text" 
                            id="loginUsername"
                            x-model="loginForm.playerName"
                            required
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Enter your commander name"
                            maxlength="20">
                    </div>
                    
                    <div>
                        <label for="loginPassword" class="block text-sm font-medium text-gray-300 mb-2">Security Code</label>
                        <input 
                            type="password" 
                            id="loginPassword"
                            x-model="loginForm.password"
                            required
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Enter your security code">
                    </div>
                    
                    <button 
                        type="submit"
                        :disabled="loginForm.loading"
                        class="w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white font-bold py-3 px-4 rounded-md transition-colors duration-200 flex items-center justify-center">
                        <span x-show="!loginForm.loading">🎯 Launch Mission</span>
                        <span x-show="loginForm.loading" class="flex items-center">
                            <svg class="animate-spin h-5 w-5 mr-2" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Processing...
                        </span>
                    </button>
                </form>

                <!-- Register Form -->
                <form x-show="showRegister" @submit.prevent="handleRegister" class="space-y-4">
                    <div>
                        <label for="registerUsername" class="block text-sm font-medium text-gray-300 mb-2">Commander Name</label>
                        <input 
                            type="text" 
                            id="registerUsername"
                            x-model="registerForm.playerName"
                            required
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Choose your commander name"
                            maxlength="20">
                    </div>
                    
                    <div>
                        <label for="registerPassword" class="block text-sm font-medium text-gray-300 mb-2">Security Code</label>
                        <input 
                            type="password" 
                            id="registerPassword"
                            x-model="registerForm.password"
                            required
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Create security code">
                    </div>
                    
                    <div>
                        <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-2">Confirm Security Code</label>
                        <input 
                            type="password" 
                            id="confirmPassword"
                            x-model="registerForm.confirmPassword"
                            required
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Confirm security code">
                    </div>
                    
                    <button 
                        type="submit"
                        :disabled="registerForm.loading"
                        class="w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white font-bold py-3 px-4 rounded-md transition-colors duration-200 flex items-center justify-center">
                        <span x-show="!registerForm.loading">🌟 Join Fleet</span>
                        <span x-show="registerForm.loading" class="flex items-center">
                            <svg class="animate-spin h-5 w-5 mr-2" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Processing...
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Game Interface (when logged in) -->
    <div x-show="isAuthenticated" class="min-h-screen relative z-10">
        <!-- Unified Header -->
        <div id="unified-header"></div>

        <!-- Main Game Content -->
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Left Panel: Ship Status & Location -->
                <div class="game-panel p-6">
                    <div class="flex justify-between items-center mb-6 border-b border-gray-600 pb-4">
                        <h2 class="text-xl font-bold text-white">🚢 Ship Status</h2>
                        <div class="bg-blue-600 bg-opacity-20 text-blue-300 px-3 py-1 rounded-full text-sm border border-blue-500" x-text="currentLocation"></div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-800 bg-opacity-60 p-4 rounded-lg text-center border border-gray-600">
                            <div class="text-2xl font-bold text-blue-400 mb-2" x-text="playerData.credits || 0"></div>
                            <div class="text-gray-300 text-sm">Credits</div>
                        </div>
                        <div class="bg-gray-800 bg-opacity-60 p-4 rounded-lg text-center border border-gray-600">
                            <div class="text-2xl font-bold text-green-400 mb-2">100%</div>
                            <div class="text-gray-300 text-sm">Hull Integrity</div>
                        </div>
                        <div class="bg-gray-800 bg-opacity-60 p-4 rounded-lg text-center border border-gray-600">
                            <div class="text-2xl font-bold text-yellow-400 mb-2">100%</div>
                            <div class="text-gray-300 text-sm">Fuel Level</div>
                        </div>
                        <div class="bg-gray-800 bg-opacity-60 p-4 rounded-lg text-center border border-gray-600">
                            <div class="text-2xl font-bold text-purple-400 mb-2">0/50</div>
                            <div class="text-gray-300 text-sm">Cargo</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <button @click="navigateToLocation('shipyard')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md transition-colors duration-200">
                            🏭 Shipyard
                        </button>
                        <button @click="navigateToLocation('trade-center')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-md transition-colors duration-200">
                            💰 Trade Center
                        </button>
                        <button @click="navigateToLocation('mission-log')" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-md transition-colors duration-200">
                            📋 Missions
                        </button>
                        <button @click="navigateToLocation('space-navigation')" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-md transition-colors duration-200">
                            🌌 Navigate
                        </button>
                    </div>
                </div>

                <!-- Right Panel: Dynamic Content -->
                <div class="game-panel p-6">
                    <div class="flex justify-between items-center mb-6 border-b border-gray-600 pb-4">
                        <h2 class="text-xl font-bold text-white" x-text="rightPanelTitle"></h2>
                        <button @click="refreshPanel()" class="bg-gray-700 hover:bg-gray-600 text-gray-300 px-3 py-1 rounded text-sm transition-colors duration-200">
                            🔄 Refresh
                        </button>
                    </div>

                    <div id="dynamic-content">
                        <!-- Overview Panel -->
                        <div x-show="currentPanel === 'overview'">
                            <div class="text-center py-8">
                                <div class="text-6xl mb-4">🌟</div>
                                <h3 class="text-2xl font-bold text-white mb-4">Welcome, Commander!</h3>
                                <p class="text-gray-300 mb-6">You are currently docked at <span class="text-blue-400 font-semibold">Keldar Station</span>.</p>
                                <p class="text-gray-400 mb-8">Your journey begins here. Use the navigation panel to explore the galaxy, trade resources, and build your reputation.</p>
                                
                                <div class="bg-blue-600 bg-opacity-20 border border-blue-500 rounded-lg p-6">
                                    <h4 class="text-blue-300 font-bold mb-4">🎯 Getting Started:</h4>
                                    <ul class="text-gray-300 text-left space-y-2">
                                        <li>• Visit the Trade Center to buy/sell resources</li>
                                        <li>• Check the Mission Log for available contracts</li>
                                        <li>• Upgrade your ship at the Shipyard</li>
                                        <li>• Explore space for new opportunities</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Loading Panel -->
                        <div x-show="currentPanel === 'loading'">
                            <div class="text-center py-16">
                                <svg class="animate-spin h-12 w-12 text-blue-400 mx-auto mb-4" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <p class="text-gray-300">Loading...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Create animated stars (matching original design)
        function createStars() {
            const starField = document.getElementById('starField');
            const numStars = 100;
            
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starField.appendChild(star);
            }
            
            // Add a few planets
            for (let i = 0; i < 3; i++) {
                const planet = document.createElement('div');
                planet.className = 'planet';
                planet.style.left = Math.random() * 80 + '%';
                planet.style.top = Math.random() * 80 + '%';
                const size = Math.random() * 50 + 20;
                planet.style.width = size + 'px';
                planet.style.height = size + 'px';
                planet.style.opacity = '0.3';
                starField.appendChild(planet);
            }
        }

        function gameApp() {
            return {
                // Authentication State
                isAuthenticated: false,
                showRegister: false,
                
                // Player Data
                playerData: {},
                playerShips: [],
                
                // Game State
                currentLocation: 'Keldar Station',
                currentPanel: 'overview',
                rightPanelTitle: '🏠 Station Overview',
                
                // Forms
                loginForm: {
                    playerName: '',
                    password: '',
                    loading: false
                },
                registerForm: {
                    playerName: '',
                    password: '',
                    confirmPassword: '',
                    loading: false
                },

                init() {
                    console.log('🎮 Game initializing...');
                    this.checkAuthentication();
                    // Initialize stars when component loads
                    this.$nextTick(() => {
                        createStars();
                    });
                },

                checkAuthentication() {
                    const currentPlayer = window.playerManager.getCurrentPlayer();
                    if (currentPlayer) {
                        this.isAuthenticated = true;
                        this.playerData = currentPlayer;
                        this.loadPlayerShips();
                        console.log('✅ Player authenticated:', currentPlayer.display_name);
                    }
                },

                handleLogin() {
                    this.loginForm.loading = true;
                    
                    // Simulate network delay for authenticity (matching original)
                    setTimeout(() => {
                        const result = window.playerManager.loginPlayer(
                            this.loginForm.playerName, 
                            this.loginForm.password
                        );
                        
                        if (result.success) {
                            this.showToast('Welcome back, Commander!', 'success');
                            this.playerData = result.player;
                            this.loadPlayerShips();
                            
                            setTimeout(() => {
                                this.isAuthenticated = true;
                            }, 1500);
                        } else {
                            this.showToast(result.error, 'error');
                        }
                        
                        this.loginForm.loading = false;
                    }, 1000);
                },

                handleRegister() {
                    if (this.registerForm.password !== this.registerForm.confirmPassword) {
                        this.showToast('Passwords do not match!', 'error');
                        return;
                    }

                    this.registerForm.loading = true;
                    
                    // Simulate network delay
                    setTimeout(() => {
                        const result = window.playerManager.registerPlayer(
                            this.registerForm.playerName, 
                            this.registerForm.password
                        );
                        
                        if (result.success) {
                            this.showToast('Welcome to the fleet, Commander!', 'success');
                            this.playerData = result.player;
                            this.loadPlayerShips();
                            
                            setTimeout(() => {
                                this.isAuthenticated = true;
                            }, 1500);
                        } else {
                            this.showToast(result.error, 'error');
                        }
                        
                        this.registerForm.loading = false;
                    }, 1000);
                },

                loadPlayerShips() {
                    const allShips = window.playerManager.getPlayerShips();
                    this.playerShips = allShips[this.playerData.player_id] || [];
                },

                navigateToLocation(location) {
                    this.currentPanel = 'loading';
                    this.rightPanelTitle = '⚡ Loading...';
                    
                    // Simulate navigation delay
                    setTimeout(() => {
                        switch(location) {
                            case 'shipyard':
                                this.currentLocation = 'Shipyard Complex';
                                this.rightPanelTitle = '🏭 Shipyard';
                                this.loadShipyardPanel();
                                break;
                            case 'trade-center':
                                this.currentLocation = 'Trade Center';
                                this.rightPanelTitle = '💰 Trade Center';
                                this.loadTradeCenterPanel();
                                break;
                            case 'mission-log':
                                this.currentLocation = 'Mission Command';
                                this.rightPanelTitle = '📋 Mission Log';
                                this.loadMissionPanel();
                                break;
                            case 'space-navigation':
                                this.currentLocation = 'Deep Space';
                                this.rightPanelTitle = '🌌 Space Navigation';
                                this.loadNavigationPanel();
                                break;
                            default:
                                this.currentLocation = 'Keldar Station';
                                this.rightPanelTitle = '🏠 Station Overview';
                                this.currentPanel = 'overview';
                        }
                    }, 800);
                },

                loadShipyardPanel() {
                    document.getElementById('dynamic-content').innerHTML = `
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">🏭</div>
                            <h3 class="text-2xl font-bold text-white mb-4">Shipyard Complex</h3>
                            <p class="text-gray-300 mb-6">Ship management and upgrade systems will be integrated here.</p>
                            <button onclick="window.open('shipyard.html', '_blank')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-md transition-colors duration-200">
                                🔧 Open Full Shipyard
                            </button>
                        </div>
                    `;
                    this.currentPanel = 'custom';
                },

                loadTradeCenterPanel() {
                    document.getElementById('dynamic-content').innerHTML = `
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">💰</div>
                            <h3 class="text-2xl font-bold text-white mb-4">Trade Center</h3>
                            <p class="text-gray-300 mb-6">Resource trading systems will be integrated here.</p>
                            <button onclick="window.open('trade-center.html', '_blank')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-md transition-colors duration-200">
                                📊 Open Full Trade Center
                            </button>
                        </div>
                    `;
                    this.currentPanel = 'custom';
                },

                loadMissionPanel() {
                    document.getElementById('dynamic-content').innerHTML = `
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">📋</div>
                            <h3 class="text-2xl font-bold text-white mb-4">Mission Command</h3>
                            <p class="text-gray-300 mb-6">Mission and contract systems will be integrated here.</p>
                            <button onclick="window.open('mission-log.html', '_blank')" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-md transition-colors duration-200">
                                🎯 Open Full Mission Log
                            </button>
                        </div>
                    `;
                    this.currentPanel = 'custom';
                },

                loadNavigationPanel() {
                    document.getElementById('dynamic-content').innerHTML = `
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">🌌</div>
                            <h3 class="text-2xl font-bold text-white mb-4">Space Navigation</h3>
                            <p class="text-gray-300 mb-6">3D space navigation system will be integrated here.</p>
                            <button onclick="window.open('space-navigation.html', '_blank')" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-md transition-colors duration-200">
                                🚀 Open Full Navigation
                            </button>
                        </div>
                    `;
                    this.currentPanel = 'custom';
                },

                refreshPanel() {
                    this.currentPanel = 'loading';
                    setTimeout(() => {
                        this.currentPanel = 'overview';
                        this.rightPanelTitle = '🏠 Station Overview';
                        this.currentLocation = 'Keldar Station';
                    }, 500);
                },

                logout() {
                    localStorage.removeItem('keldar_current_player');
                    this.isAuthenticated = false;
                    this.playerData = {};
                    this.loginForm = { playerName: '', password: '', loading: false };
                    this.registerForm = { playerName: '', password: '', confirmPassword: '', loading: false };
                    this.showToast('Logged out successfully', 'success');
                    console.log('👋 Player logged out');
                },

                showToast(message, type) {
                    Toastify({
                        text: message,
                        duration: 3000,
                        gravity: "top",
                        position: "right",
                        backgroundColor: type === 'success' ? "#10B981" : "#EF4444",
                        stopOnFocus: true
                    }).showToast();
                }
            }
        }

        // Initialize stars when page loads
        document.addEventListener('DOMContentLoaded', createStars);
    </script>
</body>
</html>
