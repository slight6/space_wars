<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Explorer - Nexus Station</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="data-manager.js"></script>
    <script src="data-loader.js"></script>
    <script src="universe-manager.js"></script>
    <script src="ship-manager.js"></script>
    <script src="advanced-ship-manager.js"></script>
    <script src="ship-mining-integration.js"></script>
    <script src="ship-status-bar.js"></script>
    <script src="unified-header.js"></script>
    <script src="scanner-system.js"></script>
    <script src="mining-system.js"></script>
    <script src="ship-equipment-system.js"></script>
    <script src="comprehensive-specialist-system.js"></script>
    <script src="universal-footer.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        .game-bg {
            background: linear-gradient(to bottom, #0f0f23, #1a1a2e, #16213e);
            min-height: 100vh;
        }
        /* Alpine.js handles show/hide with x-show directive */
        .scanner-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
    </style>
</head>
<body class="game-bg text-white" x-data="stationApp()">
    <!-- Header -->
    <header class="bg-gray-900 bg-opacity-80 backdrop-blur-sm border-b border-gray-700 px-6 py-4">
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold">üöÄ <span x-text="getStationName()"></span> - <span x-text="player.currentLocation || 'Main Deck'"></span></h1>
            </div>
            <div class="flex items-center space-x-6">
                <button @click="logout()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md text-sm transition-colors">
                    Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Unified Status Bar -->
    <div class="bg-gray-800 bg-opacity-90 backdrop-blur-sm border-b border-gray-600 px-6 py-3">
        <div class="container mx-auto">
            <div class="flex items-center justify-between">
                <!-- Left Side: Ship and Pilot Information -->
                <div class="flex items-center space-x-6">
                    <!-- Ship Icon and Name -->
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-bold">üöÄ</span>
                        </div>
                        <div>
                            <div class="text-white font-semibold text-sm" x-text="statusBar.getPilotInfo()"></div>
                            <div class="text-blue-400 font-medium text-sm" x-text="statusBar.getCurrentShipLabel()"></div>
                            <div class="text-gray-400 text-xs" x-text="'Location: ' + statusBar.getCurrentLocation()"></div>
                            <div class="text-gray-400 text-xs" x-text="'Sector: ' + getSectorDisplayName()"></div>
                        </div>
                    </div>
                    
                    <!-- Ship Status Indicators -->
                    <div class="hidden md:flex items-center space-x-4 text-sm">
                        <div class="flex items-center space-x-1">
                            <span class="text-gray-400">Hull:</span>
                            <span class="text-cyan-400 font-semibold" x-text="statusBar.getHullIntegrity() + '%'"></span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-gray-400">Shields:</span>
                            <span class="text-purple-400 font-semibold" x-text="statusBar.getShieldStrength() + '%'"></span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-gray-400">Fuel:</span>
                            <span class="text-orange-400 font-semibold" x-text="statusBar.getFuelLevel() + '%'"></span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-gray-400">Power:</span>
                            <span class="text-red-400 font-semibold" x-text="statusBar.getPowerLevel() + '%'"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Right Side: Status and Credits -->
                <div class="text-right">
                    <div class="text-sm font-semibold" :class="statusBar.getSystemStatus().color" x-text="statusBar.getSystemStatus().status"></div>
                    <div class="text-yellow-400 font-mono text-sm" x-text="'Credits: ' + statusBar.getCredits().toLocaleString()"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Interface -->
    <div class="container mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Left Panel - Navigation Dropdowns -->
            <div class="lg:col-span-1 space-y-4">
                
                <!-- Ship Information Dropdown -->
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg border border-gray-700" x-show="getAvailableFeatures().shipInfo.length > 0">
                    <div class="dropdown">
                        <button @click="toggleDropdown('shipInfo')" class="w-full p-4 text-left flex justify-between items-center hover:bg-gray-800 transition-colors">
                            <span class="font-semibold text-blue-400">üöÄ Ship Information</span>
                            <span x-text="dropdowns.shipInfo ? '‚ñº' : '‚ñ∂'" class="text-gray-400"></span>
                        </button>
                        <div x-show="dropdowns.shipInfo" class="dropdown-menu border-t border-gray-700">
                            <template x-if="hasAccess('basic_status')">
                                <a href="#" @click.prevent="showBasicShipStatus()" class="block px-4 py-2 hover:bg-gray-800 text-sm">‚ÑπÔ∏è Basic Ship Status</a>
                            </template>
                            <template x-if="hasAccess('cargo')">
                                <a href="#" @click.prevent="showCargoManifest()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üì¶ Cargo Manifest</a>
                            </template>
                            <template x-if="hasAccess('crew')">
                                <a href="#" @click.prevent="showCrewInfo()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üë• Crew Information</a>
                            </template>
                            <template x-if="hasAccess('upgrades')">
                                <a href="#" @click.prevent="showUpgrades()" class="block px-4 py-2 hover:bg-gray-800 text-sm">‚ö° List Upgrades</a>
                            </template>
                            <template x-if="hasAccess('logs')">
                                <a href="#" @click.prevent="showShipLogs()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üìã Ship Logs</a>
                            </template>
                            <template x-if="hasAccess('status')">
                                <a href="inventory.html" class="block px-4 py-2 hover:bg-gray-800 text-sm">‚ÑπÔ∏è Complete Ship Status</a>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Ship Options Dropdown -->
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg border border-gray-700" x-show="getAvailableFeatures().shipOptions.length > 0">
                    <div class="dropdown">
                        <button @click="toggleDropdown('shipOptions')" class="w-full p-4 text-left flex justify-between items-center hover:bg-gray-800 transition-colors">
                            <span class="font-semibold text-cyan-400">‚öôÔ∏è Ship Options</span>
                            <span x-text="dropdowns.shipOptions ? '‚ñº' : '‚ñ∂'" class="text-gray-400"></span>
                        </button>
                        <div x-show="dropdowns.shipOptions" class="dropdown-menu border-t border-gray-700">
                            <template x-if="hasAccess('cargo_config')">
                                <a href="#" @click.prevent="configureCargo()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üì¶ Cargo Options</a>
                            </template>
                            <template x-if="hasAccess('weapons')">
                                <a href="#" @click.prevent="configureWeapons()" class="block px-4 py-2 hover:bg-gray-800 text-sm">‚öîÔ∏è Weapons Systems</a>
                            </template>
                            <template x-if="hasAccess('shields')">
                                <a href="#" @click.prevent="configureShields()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üõ°Ô∏è Shields & Defense</a>
                            </template>
                            <template x-if="hasAccess('communications')">
                                <a href="#" @click.prevent="configureCommunications()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üì° Communications</a>
                            </template>
                            <template x-if="hasAccess('life_support')">
                                <a href="#" @click.prevent="configureLifeSupport()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üí® Life Support</a>
                            </template>
                            <template x-if="hasAccess('cloaking')">
                                <a href="#" @click.prevent="configureCloaking()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üëª Cloaking Device</a>
                            </template>
                            <template x-if="hasAccess('nanobots')">
                                <a href="#" @click.prevent="configureNanobots()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üîß Auto-Repair Nanobots</a>
                            </template>
                            <template x-if="hasAccess('gravity')">
                                <a href="#" @click.prevent="configureGravity()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üåç Gravity Generator</a>
                            </template>
                            <template x-if="hasAccess('sensors')">
                                <a href="#" @click.prevent="configureSensors()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üì° Sensor Range</a>
                            </template>
                            <template x-if="hasAccess('hidden_compartment')">
                                <a href="#" @click.prevent="configureBlackMarket()" class="block px-4 py-2 hover:bg-gray-800 text-sm text-red-400">üï≥Ô∏è Hidden Compartment</a>
                            </template>
                            <div x-show="hasAccess('management') || hasAccess('loadouts')" class="border-t border-gray-600 mt-2 pt-2">
                                <template x-if="hasAccess('management')">
                                    <a href="ship-management.html" class="block px-4 py-2 hover:bg-gray-800 text-sm font-semibold text-blue-400">üöÄ Advanced Ship Management</a>
                                </template>
                                <template x-if="hasAccess('loadouts')">
                                    <a href="#" @click.prevent="manageLoadouts()" class="block px-4 py-2 hover:bg-gray-800 text-sm font-semibold text-yellow-400">‚ö° Manage Loadouts</a>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ship Actions Dropdown -->
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg border border-gray-700" x-show="getAvailableFeatures().shipActions.length > 0">
                    <div class="dropdown">
                        <button @click="toggleDropdown('shipActions')" class="w-full p-4 text-left flex justify-between items-center hover:bg-gray-800 transition-colors">
                            <span class="font-semibold text-green-400">üéØ Ship Actions</span>
                            <span x-text="dropdowns.shipActions ? '‚ñº' : '‚ñ∂'" class="text-gray-400"></span>
                        </button>
                        <div x-show="dropdowns.shipActions" class="dropdown-menu border-t border-gray-700">
                            <div x-show="hasAccess('basic_scanning') || hasAccess('spatial_scanner') || hasAccess('surface_scanner') || hasAccess('prospecting_scanner') || hasAccess('skimming_scanner') || hasAccess('ship_scanner')" class="px-4 py-2 text-xs text-gray-400 font-semibold">SCANNER OPTIONS</div>
                            <template x-if="hasAccess('basic_scanning')">
                                <a href="#" @click.prevent="useBasicScanner()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üîç Basic Scanner</a>
                            </template>
                            <template x-if="hasAccess('spatial_scanner')">
                                <a href="#" @click.prevent="useSpatialScanner()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üåå Spatial Scanners</a>
                            </template>
                            <template x-if="hasAccess('surface_scanner')">
                                <a href="#" @click.prevent="useSurfaceScanner()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üèîÔ∏è Surface Scanners</a>
                            </template>
                            <template x-if="hasAccess('prospecting_scanner')">
                                <a href="#" @click.prevent="useProspectingScanner()" class="block px-4 py-2 hover:bg-gray-800 text-sm">‚õèÔ∏è Prospecting Scanners</a>
                            </template>
                            <template x-if="hasAccess('skimming_scanner')">
                                <a href="#" @click.prevent="useSkimmingScanner()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üí® Skimming Scanners</a>
                            </template>
                            <template x-if="hasAccess('ship_scanner')">
                                <a href="#" @click.prevent="useShipScanner()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üöÄ Ship Scanners</a>
                            </template>
                            <div x-show="hasAccess('basic_movement') || hasAccess('movement') || hasAccess('fuel_power') || hasAccess('mining') || hasAccess('torpedo') || hasAccess('navigation')" class="border-t border-gray-600 mt-2 pt-2">
                                <div class="px-4 py-2 text-xs text-gray-400 font-semibold">OPERATIONS</div>
                                <template x-if="hasAccess('basic_movement')">
                                    <a href="#" @click.prevent="showBasicMovement()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üöÄ Basic Movement</a>
                                </template>
                                <template x-if="hasAccess('movement')">
                                    <a href="#" @click.prevent="manageMovement()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üöÄ Movement Options</a>
                                </template>
                                <template x-if="hasAccess('fuel_power')">
                                    <a href="#" @click.prevent="manageFuelPower()" class="block px-4 py-2 hover:bg-gray-800 text-sm">‚ö° Fuel & Power</a>
                                </template>
                                <template x-if="hasAccess('mining')">
                                    <a href="#" @click.prevent="manageMining()" class="block px-4 py-2 hover:bg-gray-800 text-sm">‚õèÔ∏è Mining Operations</a>
                                </template>
                                <template x-if="hasAccess('torpedo')">
                                    <a href="torpedo-launch.html" class="block px-4 py-2 hover:bg-gray-800 text-sm text-red-400">üöÄ Torpedo Launch</a>
                                </template>
                                <template x-if="hasAccess('navigation')">
                                    <a href="space-navigation.html" class="block px-4 py-2 hover:bg-gray-800 text-sm text-cyan-400">üåå 3D Space Navigation</a>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Station Locations Dropdown -->
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg border border-gray-700" x-show="getAvailableFeatures().stationLocations.length > 0">
                    <div class="dropdown">
                        <button @click="toggleDropdown('stationLocations')" class="w-full p-4 text-left flex justify-between items-center hover:bg-gray-800 transition-colors">
                            <span class="font-semibold text-purple-400">üè¢ Station Locations</span>
                            <span x-text="dropdowns.stationLocations ? '‚ñº' : '‚ñ∂'" class="text-gray-400"></span>
                        </button>
                        <div x-show="dropdowns.stationLocations" class="dropdown-menu border-t border-gray-700">
                            <!-- Training Phase Features -->
                            <template x-if="hasAccess('orientation_center')">
                                <a href="#" @click.prevent="visitOrientationCenter()" class="block px-4 py-2 hover:bg-gray-800 text-sm text-green-400">ÔøΩ Orientation Center</a>
                            </template>
                            <template x-if="hasAccess('docking_bay')">
                                <a href="#" @click.prevent="visitDockingBay()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üöÄ Docking Bay</a>
                            </template>
                            <template x-if="hasAccess('training_marketplace')">
                                <a href="#" @click.prevent="visitTrainingMarketplace()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üõí Training Marketplace</a>
                            </template>
                            
                            <!-- Basic Features -->
                            <template x-if="hasAccess('maps')">
                                <a href="system-map.html" class="block px-4 py-2 hover:bg-gray-800 text-sm">üó∫Ô∏è Local Maps</a>
                            </template>
                            <template x-if="hasAccess('missions')">
                                <a href="mission-log.html" class="block px-4 py-2 hover:bg-gray-800 text-sm">üìã Mission Log</a>
                            </template>
                            <template x-if="hasAccess('navigation')">
                                <a href="space-navigation.html" class="block px-4 py-2 hover:bg-gray-800 text-sm text-cyan-400">üåå 3D Navigation</a>
                            </template>
                            
                            <!-- Commerce Features -->
                            <template x-if="hasAccess('marketplace')">
                                <a href="marketplace.html" class="block px-4 py-2 hover:bg-gray-800 text-sm">üõí Marketplace</a>
                            </template>
                            <template x-if="hasAccess('trading')">
                                <a href="trade-center.html" class="block px-4 py-2 hover:bg-gray-800 text-sm">üè¶ Trading Zone</a>
                            </template>
                            
                            <!-- Advanced Features (Admin Only) -->
                            <template x-if="hasAccess('shipyard')">
                                <a href="shipyard.html" class="block px-4 py-2 hover:bg-gray-800 text-sm">ÔøΩ Shipyard</a>
                            </template>
                            <template x-if="hasAccess('mining_ops')">
                                <a href="mining-operations.html" class="block px-4 py-2 hover:bg-gray-800 text-sm text-orange-400 font-semibold">‚õèÔ∏è Mining Operations</a>
                            </template>
                            <template x-if="hasAccess('equipment')">
                                <a href="#" @click.prevent="visitEquipmentCenter()" class="block px-4 py-2 hover:bg-gray-800 text-sm">‚öîÔ∏è Equipment Center</a>
                            </template>
                            <template x-if="hasAccess('tavern')">
                                <a href="#" @click.prevent="visitTavern()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üç∫ Tavern</a>
                            </template>
                            <template x-if="hasAccess('government')">
                                <a href="#" @click.prevent="visitGovernment()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üèõÔ∏è Government Services</a>
                            </template>
                            <template x-if="hasAccess('specialists')">
                                <a href="specialists.html" class="block px-4 py-2 hover:bg-gray-800 text-sm">ÔøΩ State Specialists</a>
                            </template>
                            <template x-if="hasAccess('training')">
                                <a href="comprehensive-specialists.html" class="block px-4 py-2 hover:bg-gray-800 text-sm text-yellow-400">ÔøΩ Comprehensive Training</a>
                            </template>
                            <template x-if="hasAccess('quick_training')">
                                <a href="#" @click.prevent="showQuickTraining()" class="block px-4 py-2 hover:bg-gray-800 text-sm text-green-400">‚ö° Quick Training Overview</a>
                            </template>
                            <template x-if="hasAccess('news')">
                                <a href="#" @click.prevent="checkNews()" class="block px-4 py-2 hover:bg-gray-800 text-sm">ÔøΩ Local News</a>
                            </template>
                            <template x-if="hasAccess('manufacturing')">
                                <a href="#" @click.prevent="visitManufacturing()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üè≠ Manufacturing</a>
                            </template>
                            <template x-if="hasAccess('research')">
                                <a href="#" @click.prevent="visitResearch()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üî¨ Research Lab</a>
                            </template>
                            <template x-if="hasAccess('agriculture')">
                                <a href="#" @click.prevent="visitAgriculture()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üå± Agricultural Center</a>
                            </template>
                            <template x-if="hasAccess('museum')">
                                <a href="#" @click.prevent="visitMuseum()" class="block px-4 py-2 hover:bg-gray-800 text-sm">üèõÔ∏è Museum</a>
                            </template>
                            <template x-if="hasAccess('temple')">
                                <a href="#" @click.prevent="visitTemple()" class="block px-4 py-2 hover:bg-gray-800 text-sm">‚õ™ Temple of the Dog</a>
                            </template>
                            <a href="#" @click.prevent="showUniverseInfo()" x-show="isAdminUser()" class="block px-4 py-2 hover:bg-gray-800 text-sm text-red-400">üåå Universe Administration</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="lg:col-span-3">
                <!-- Current View Display -->
                <div class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg p-6 border border-gray-700 mb-6">
                    <h2 class="text-xl font-bold mb-4" x-text="currentView.title"></h2>
                    <div x-html="currentView.content"></div>
                </div>

                <!-- Scanner Results (when applicable) -->
                <div x-show="scannerResults.visible" class="bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-lg p-6 border border-gray-700">
                    <h3 class="text-lg font-bold mb-4 text-cyan-400">üì° Scanner Results</h3>
                    <div x-html="scannerResults.data"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global function to access station app instance for onclick handlers
        function getStationApp() {
            return window.stationAppInstance;
        }
        
        function stationApp() {
            return {
                player: {},
                dropdowns: {
                    shipInfo: false,
                    shipOptions: false,
                    shipActions: false,
                    stationLocations: false
                },
                currentView: {
                    title: 'Welcome to Nexus Station',
                    content: `
                        <div class="space-y-4">
                            <p class="text-gray-300">Welcome aboard Nexus Station, the central hub of the Keldar system. Use the navigation panel on the left to access different areas of your ship and the station.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-400 mb-2">üöÄ Ship Status</h4>
                                    <p class="text-sm text-gray-300">Your ship is docked and ready for operations. All systems are nominal.</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-400 mb-2">üì° Station Services</h4>
                                    <p class="text-sm text-gray-300">Full station services are available including trading, repairs, and research.</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-400 mb-2">üåç Local Area</h4>
                                    <p class="text-sm text-gray-300">Keldar system - Prime star system with multiple explorable locations.</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-yellow-400 mb-2">‚ö° Quick Actions</h4>
                                    <p class="text-sm text-gray-300">Access scanners, configure ship systems, or visit station locations.</p>
                                </div>
                            </div>
                        </div>
                    `
                },
                scannerResults: {
                    visible: false,
                    data: ''
                },

                async init() {
                    const currentPlayer = localStorage.getItem('currentPlayer');
                    if (!currentPlayer) {
                        window.location.href = 'index.html';
                        return;
                    }
                    
                    this.player = JSON.parse(currentPlayer);
                    
                    // Ensure universe information is loaded
                    if (!this.player.universeInfo) {
                        console.log('Initializing universe info for existing player');
                        const universeData = await window.UniverseManager.initializePlayerUniverse(this.player.username);
                        this.player.universeInfo = universeData.universeInfo;
                        this.player.currentLocation = universeData.currentLocation;
                        this.player.systemData = universeData.systemData;
                        
                        // Save updated player data
                        localStorage.setItem('currentPlayer', JSON.stringify(this.player));
                    }
                    
                    // Update current view based on sector
                    this.updateViewForSector();
                    
                    this.initializePlayerDefaults();
                    this.initializeLicenses();
                    this.initializeScannersAndMining();
                    this.initializeComprehensiveSpecialistSystem();
                    this.savePlayer();
                    
                    // Initialize unified status bar
                    initializeStatusBar(this);
                    
                    // Store global reference for onclick handlers
                    window.stationAppInstance = this;
                },

                initializePlayerDefaults() {
                    // Set ship name from starter ship if available, otherwise use default
                    if (!this.player.currentShip) {
                        if (this.player.starterShip && this.player.starterShip.customName) {
                            this.player.currentShip = this.player.starterShip.customName;
                        } else {
                            this.player.currentShip = 'Standard Explorer';
                        }
                    }
                    
                    if (!this.player.hullIntegrity) this.player.hullIntegrity = 100;
                    if (!this.player.shieldStrength) this.player.shieldStrength = 100;
                    if (!this.player.fuel) this.player.fuel = 67;
                    if (!this.player.powerLevel) this.player.powerLevel = 89;
                    if (!this.player.currentLocation) this.player.currentLocation = this.getDefaultLocation();
                },

                getStationName() {
                    if (!this.player.universeInfo) return 'Station';
                    
                    const sectorKey = this.player.universeInfo.currentSector;
                    if (sectorKey === 'admin_sector') {
                        return 'Nexus Station';
                    } else if (sectorKey === 'new_player_sector') {
                        return 'Frontier Hub Station';
                    }
                    return 'Station';
                },

                getDefaultLocation() {
                    if (!this.player.universeInfo) return 'Main Deck';
                    
                    const sectorKey = this.player.universeInfo.currentSector;
                    if (sectorKey === 'admin_sector') {
                        return 'Main Deck';
                    } else if (sectorKey === 'new_player_sector') {
                        return 'Orientation Center';
                    }
                    return 'Main Deck';
                },

                isAdminUser() {
                    return this.player.username === 'slight';
                },

                showUniverseInfo() {
                    if (!this.isAdminUser()) return;
                    
                    const universeConfig = window.UniverseManager.universeConfig;
                    const distance = window.UniverseManager.calculateSectorDistance('admin_sector', 'new_player_sector');
                    
                    this.currentView = {
                        title: 'üåå Universe Administration',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-red-900 border border-red-500 p-4 rounded-lg">
                                    <h4 class="font-semibold text-red-400 mb-2">‚ö†Ô∏è Administrator Access</h4>
                                    <p class="text-sm text-gray-300">You have access to universe-wide administrative functions.</p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-gray-800 p-4 rounded-lg">
                                        <h4 class="font-semibold text-blue-400 mb-2">üèõÔ∏è Admin Sector (Keldar)</h4>
                                        <p class="text-sm text-gray-300">Location: Galaxy [0,0,0] System [8,8,8]</p>
                                        <p class="text-sm text-gray-300">Users: slight (admin access)</p>
                                        <p class="text-sm text-gray-300">Features: Full system access, Nexus Station</p>
                                    </div>
                                    
                                    <div class="bg-gray-800 p-4 rounded-lg">
                                        <h4 class="font-semibold text-green-400 mb-2">üéì Training Sector (Frontier)</h4>
                                        <p class="text-sm text-gray-300">Location: Galaxy [15,15,15] System [2,3,7]</p>
                                        <p class="text-sm text-gray-300">Users: New players (training access)</p>
                                        <p class="text-sm text-gray-300">Features: Safe zone, Frontier Hub Station</p>
                                    </div>
                                    
                                    <div class="bg-gray-800 p-4 rounded-lg col-span-2">
                                        <h4 class="font-semibold text-purple-400 mb-2">üìä Universe Statistics</h4>
                                        <p class="text-sm text-gray-300">Distance between sectors: ${distance.toLocaleString()} light-years</p>
                                        <p class="text-sm text-gray-300">Universe size: 16¬≥ galaxies √ó 16¬≥ systems = ${(16*16*16 * 16*16*16).toLocaleString()} total locations</p>
                                        <p class="text-sm text-gray-300">Active sectors: 2 out of ${(16*16*16 * 16*16*16).toLocaleString()}</p>
                                    </div>
                                </div>
                                
                                <div class="bg-yellow-900 border border-yellow-500 p-4 rounded-lg">
                                    <h4 class="font-semibold text-yellow-400 mb-2">üîí Access Control Status</h4>
                                    <p class="text-sm text-gray-300">‚úì Admin sector restricted to 'slight' user</p>
                                    <p class="text-sm text-gray-300">‚úì New players automatically assigned to Frontier sector</p>
                                    <p class="text-sm text-gray-300">‚úì Cross-sector travel currently disabled</p>
                                </div>
                            </div>
                        `
                    };
                },

                getSectorDisplayName() {
                    if (!this.player.universeInfo) return 'Unknown Sector';
                    
                    const sectorKey = this.player.universeInfo.currentSector;
                    const sector = window.UniverseManager.getSectorInfo(sectorKey);
                    return sector ? sector.name : sectorKey;
                },

                getPlayerProgression() {
                    // Get player's training progress from localStorage or player data
                    const progressData = JSON.parse(localStorage.getItem('playerProgression') || '{}');
                    const playerProgress = progressData[this.player.username] || {
                        completedModules: [],
                        unlockedFeatures: ['orientation'], // Start with just orientation
                        currentPhase: 'orientation'
                    };
                    
                    // Save default progress if new
                    if (!progressData[this.player.username]) {
                        progressData[this.player.username] = playerProgress;
                        localStorage.setItem('playerProgression', JSON.stringify(progressData));
                    }
                    
                    return playerProgress;
                },

                hasAccess(featureId) {
                    // Admin users have access to everything
                    if (this.isAdminUser()) return true;
                    
                    // New players: check progression-based access
                    if (this.isNewPlayerSector()) {
                        const progression = this.getPlayerProgression();
                        return progression.unlockedFeatures.includes(featureId);
                    }
                    
                    // Default: allow access (for future sectors)
                    return true;
                },

                getAvailableFeatures() {
                    if (this.isAdminUser()) {
                        return {
                            shipInfo: ['cargo', 'crew', 'upgrades', 'logs', 'status'],
                            shipOptions: ['weapons', 'cargo_config', 'shields', 'communications', 'life_support', 'cloaking', 'nanobots', 'gravity', 'sensors', 'hidden_compartment', 'management', 'loadouts'],
                            shipActions: ['spatial_scanner', 'surface_scanner', 'prospecting_scanner', 'skimming_scanner', 'ship_scanner', 'movement', 'fuel_power', 'mining', 'torpedo', 'navigation'],
                            stationLocations: ['shipyard', 'mining_ops', 'equipment', 'marketplace', 'trading', 'tavern', 'government', 'specialists', 'training', 'quick_training', 'maps', 'navigation', 'news', 'missions', 'manufacturing', 'research', 'agriculture', 'museum']
                        };
                    }
                    
                    // New player progression-based features
                    const progression = this.getPlayerProgression();
                    const baseFeatures = {
                        shipInfo: [],
                        shipOptions: [],
                        shipActions: [],
                        stationLocations: []
                    };
                    
                    // Progressive feature unlocking based on training modules completed
                    if (progression.unlockedFeatures.includes('orientation')) {
                        baseFeatures.stationLocations.push('orientation_center');
                        baseFeatures.shipInfo.push('basic_status');
                    }
                    
                    if (progression.unlockedFeatures.includes('ship_operations')) {
                        baseFeatures.shipInfo.push('cargo', 'status');
                        baseFeatures.shipActions.push('basic_movement');
                        baseFeatures.stationLocations.push('docking_bay');
                    }
                    
                    if (progression.unlockedFeatures.includes('resource_gathering')) {
                        baseFeatures.shipActions.push('basic_scanning', 'mining');
                        baseFeatures.stationLocations.push('training_marketplace');
                    }
                    
                    if (progression.unlockedFeatures.includes('safe_exploration')) {
                        baseFeatures.shipActions.push('navigation', 'surface_scanner');
                        baseFeatures.stationLocations.push('maps', 'missions');
                    }
                    
                    if (progression.unlockedFeatures.includes('trade_fundamentals')) {
                        baseFeatures.stationLocations.push('marketplace', 'trading');
                        baseFeatures.shipOptions.push('cargo_config');
                    }
                    
                    return baseFeatures;
                },

                isNewPlayerSector() {
                    return this.player.universeInfo && this.player.universeInfo.currentSector === 'new_player_sector';
                },

                showBasicShipStatus() {
                    this.currentView = {
                        title: 'üöÄ Basic Ship Status',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-blue-900 border border-blue-500 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-400 mb-2">üìö Training Module: Ship Operations 101</h4>
                                    <p class="text-sm text-gray-300 mb-3">Learn the basics of your ship's systems and status monitoring.</p>
                                    <div class="space-y-2">
                                        <p class="text-sm"><span class="text-blue-400">Ship Name:</span> ${this.player.starterShip?.customName || 'Starling Explorer'}</p>
                                        <p class="text-sm"><span class="text-blue-400">Hull Integrity:</span> 100%</p>
                                        <p class="text-sm"><span class="text-blue-400">Power Level:</span> Online</p>
                                        <p class="text-sm"><span class="text-blue-400">Life Support:</span> Active</p>
                                        <p class="text-sm"><span class="text-blue-400">Training Status:</span> Beginner Level</p>
                                    </div>
                                    <button onclick="gameApp().completeTrainingModule('ship_operations')" class="mt-4 bg-green-600 hover:bg-green-700 px-4 py-2 rounded text-sm">Complete Module</button>
                                </div>
                            </div>
                        `
                    };
                },

                visitOrientationCenter() {
                    this.currentView = {
                        title: 'üéì Frontier Hub - Orientation Center',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-green-900 border border-green-500 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-400 mb-2">Welcome to the Frontier Training System!</h4>
                                    <p class="text-sm text-gray-300 mb-4">You are now aboard Frontier Hub Station in a safe training environment far from any dangerous sectors.</p>
                                    
                                    <div class="space-y-3">
                                        <h5 class="font-semibold text-green-300">Available Training Modules:</h5>
                                        <div class="space-y-2 ml-4">
                                            <div class="flex items-center justify-between bg-gray-800 p-3 rounded">
                                                <div>
                                                    <p class="text-sm font-semibold">Ship Operations 101</p>
                                                    <p class="text-xs text-gray-400">Learn basic ship controls and status monitoring</p>
                                                </div>
                                                <button onclick="gameApp().showBasicShipStatus()" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-xs">Start</button>
                                            </div>
                                            
                                            <div class="flex items-center justify-between bg-gray-800 p-3 rounded opacity-60">
                                                <div>
                                                    <p class="text-sm font-semibold">Resource Gathering Basics</p>
                                                    <p class="text-xs text-gray-400">Complete Ship Operations 101 first</p>
                                                </div>
                                                <span class="text-xs text-gray-500">Locked</span>
                                            </div>
                                            
                                            <div class="flex items-center justify-between bg-gray-800 p-3 rounded opacity-60">
                                                <div>
                                                    <p class="text-sm font-semibold">Safe Exploration</p>
                                                    <p class="text-xs text-gray-400">Complete Resource Gathering first</p>
                                                </div>
                                                <span class="text-xs text-gray-500">Locked</span>
                                            </div>
                                            
                                            <div class="flex items-center justify-between bg-gray-800 p-3 rounded opacity-60">
                                                <div>
                                                    <p class="text-sm font-semibold">Trade Fundamentals</p>
                                                    <p class="text-xs text-gray-400">Complete Safe Exploration first</p>
                                                </div>
                                                <span class="text-xs text-gray-500">Locked</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-900 border border-blue-500 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-400 mb-2">üìç Your Location</h4>
                                    <p class="text-sm text-gray-300">Frontier Hub Station - Training Sector</p>
                                    <p class="text-xs text-gray-400">Galaxy [15,15,15] ‚Ä¢ System [2,3,7] ‚Ä¢ Safe Zone</p>
                                </div>
                            </div>
                        `
                    };
                },

                completeTrainingModule(moduleId) {
                    const progressData = JSON.parse(localStorage.getItem('playerProgression') || '{}');
                    const playerProgress = progressData[this.player.username] || {
                        completedModules: [],
                        unlockedFeatures: ['orientation'],
                        currentPhase: 'orientation'
                    };
                    
                    if (!playerProgress.completedModules.includes(moduleId)) {
                        playerProgress.completedModules.push(moduleId);
                        
                        // Unlock features based on completed module
                        switch(moduleId) {
                            case 'ship_operations':
                                playerProgress.unlockedFeatures.push('ship_operations', 'docking_bay');
                                playerProgress.currentPhase = 'ship_basics';
                                break;
                            case 'resource_gathering':
                                playerProgress.unlockedFeatures.push('resource_gathering', 'training_marketplace');
                                playerProgress.currentPhase = 'resource_basics';
                                break;
                            case 'safe_exploration':
                                playerProgress.unlockedFeatures.push('safe_exploration', 'maps', 'missions');
                                playerProgress.currentPhase = 'exploration_basics';
                                break;
                            case 'trade_fundamentals':
                                playerProgress.unlockedFeatures.push('trade_fundamentals', 'marketplace', 'trading');
                                playerProgress.currentPhase = 'trade_basics';
                                break;
                        }
                        
                        progressData[this.player.username] = playerProgress;
                        localStorage.setItem('playerProgression', JSON.stringify(progressData));
                        
                        this.showToast(`Training module "${moduleId}" completed! New features unlocked.`, 'success');
                        
                        // Refresh the orientation center view to show progress
                        setTimeout(() => this.visitOrientationCenter(), 1000);
                    }
                },

                updateViewForSector() {
                    if (!this.player.universeInfo) return;
                    
                    const sectorKey = this.player.universeInfo.currentSector;
                    
                    if (sectorKey === 'admin_sector') {
                        this.currentView = {
                            title: 'Welcome to Nexus Station',
                            content: `
                                <div class="space-y-4">
                                    <p class="text-gray-300">Welcome aboard Nexus Station, the central hub of the Keldar system. Use the navigation panel on the left to access different areas of your ship and the station.</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                                        <div class="bg-gray-800 p-4 rounded-lg">
                                            <h4 class="font-semibold text-blue-400 mb-2">üöÄ Ship Status</h4>
                                            <p class="text-sm text-gray-300">Your ship is docked and ready for operations. All systems are nominal.</p>
                                        </div>
                                        <div class="bg-gray-800 p-4 rounded-lg">
                                            <h4 class="font-semibold text-green-400 mb-2">üì° Station Services</h4>
                                            <p class="text-sm text-gray-300">Full station services are available including trading, repairs, and research.</p>
                                        </div>
                                        <div class="bg-gray-800 p-4 rounded-lg">
                                            <h4 class="font-semibold text-purple-400 mb-2">üåç Local Area</h4>
                                            <p class="text-sm text-gray-300">Keldar system - Prime star system with multiple explorable locations.</p>
                                        </div>
                                        <div class="bg-gray-800 p-4 rounded-lg">
                                            <h4 class="font-semibold text-yellow-400 mb-2">‚ö° Quick Actions</h4>
                                            <p class="text-sm text-gray-300">Access scanners, configure ship systems, or visit station locations.</p>
                                        </div>
                                    </div>
                                </div>
                            `
                        };
                    } else if (sectorKey === 'new_player_sector') {
                        // Check if this is their first time - if so, go directly to orientation
                        const progression = this.getPlayerProgression();
                        if (progression.completedModules.length === 0) {
                            this.visitOrientationCenter();
                        } else {
                            this.currentView = {
                                title: 'Welcome to Frontier Hub Station',
                                content: `
                                    <div class="space-y-4">
                                        <p class="text-gray-300">Welcome back to Frontier Hub Station! Continue your training to unlock new areas and features.</p>
                                        <div class="bg-blue-900 border border-blue-500 p-4 rounded-lg mb-4">
                                            <h4 class="font-semibold text-blue-400 mb-2">üéì Training Progress</h4>
                                            <p class="text-sm text-gray-300">Completed modules: ${progression.completedModules.length}/4</p>
                                            <p class="text-sm text-gray-300">Current phase: ${progression.currentPhase}</p>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                                            <div class="bg-gray-800 p-4 rounded-lg">
                                                <h4 class="font-semibold text-blue-400 mb-2">üöÄ Available Features</h4>
                                                <p class="text-sm text-gray-300">New features unlock as you complete training modules.</p>
                                                <button onclick="gameApp().visitOrientationCenter()" class="mt-2 bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm">Continue Training</button>
                                            </div>
                                            <div class="bg-gray-800 p-4 rounded-lg">
                                                <h4 class="font-semibold text-green-400 mb-2">üì° Training Services</h4>
                                                <p class="text-sm text-gray-300">Access training simulators, basic supplies, and educational resources.</p>
                                            </div>
                                            <div class="bg-gray-800 p-4 rounded-lg">
                                                <h4 class="font-semibold text-purple-400 mb-2">üåç Safe Zone</h4>
                                                <p class="text-sm text-gray-300">Frontier Training System - A safe environment for learning and practice.</p>
                                            </div>
                                            <div class="bg-gray-800 p-4 rounded-lg">
                                                <h4 class="font-semibold text-yellow-400 mb-2">‚ö° Features Unlocked</h4>
                                                <p class="text-sm text-gray-300">Features: ${progression.unlockedFeatures.join(', ')}</p>
                                            </div>
                                        </div>
                                    </div>
                                `
                            };
                        }
                    }
                },

                initializeLicenses() {
                    if (!this.player.licenses) this.player.licenses = {};
                    if (!this.player.licenseProgress) this.player.licenseProgress = {};
                    if (!this.player.violations) this.player.violations = 0;
                    if (!this.player.legalStanding) this.player.legalStanding = 'Good';
                    if (!this.player.experience) this.player.experience = {};
                },

                toggleDropdown(dropdown) {
                    this.dropdowns[dropdown] = !this.dropdowns[dropdown];
                },

                // Ship Information Functions
                showCargoManifest() {
                    this.currentView = {
                        title: 'üì¶ Cargo Manifest',
                        content: this.generateCargoManifest()
                    };
                },

                showCrewInfo() {
                    this.currentView = {
                        title: 'üë• Crew Information',
                        content: this.generateCrewInfo()
                    };
                },

                showUpgrades() {
                    this.currentView = {
                        title: '‚ö° Ship Upgrades',
                        content: this.generateUpgradesList()
                    };
                },

                showShipLogs() {
                    this.currentView = {
                        title: 'üìã Ship Logs',
                        content: this.generateShipLogs()
                    };
                },

                // Scanner Functions - Connected to actual scanner system
                useSpatialScanner() {
                    if (!window.scannerSystem) {
                        this.showNotification('Scanner system not available', 'error');
                        return;
                    }
                    
                    const result = window.scannerSystem.startScan('spatial', 'stage1', this.player.coordinates);
                    if (result.success) {
                        this.currentView = {
                            title: 'üåå Spatial Scanner Active',
                            content: `<p class="text-blue-400">Spatial scan initiated...</p>
                                     <p class="text-gray-300">Scan duration: ${Math.round(result.duration/1000)} seconds</p>
                                     <p class="text-yellow-400">Energy consumed: 5 units</p>`
                        };
                        this.showNotification('Spatial scan started', 'success');
                    } else {
                        this.currentView = {
                            title: 'üåå Spatial Scanner Error',
                            content: `<p class="text-red-400">Scanner Error: ${result.error}</p>`
                        };
                        this.showNotification(result.error, 'error');
                    }
                },

                useSurfaceScanner() {
                    if (!window.scannerSystem) {
                        this.showNotification('Scanner system not available', 'error');
                        return;
                    }
                    
                    const result = window.scannerSystem.startScan('surface', 'stage1', this.player.coordinates);
                    if (result.success) {
                        this.currentView = {
                            title: 'üèîÔ∏è Surface Scanner Active',
                            content: `<p class="text-green-400">Surface scan initiated...</p>
                                     <p class="text-gray-300">Analyzing planetary surface composition</p>
                                     <p class="text-yellow-400">Energy consumed: 3 units</p>`
                        };
                        this.showNotification('Surface scan started', 'success');
                    } else {
                        this.currentView = {
                            title: 'üèîÔ∏è Surface Scanner Error',
                            content: `<p class="text-red-400">Scanner Error: ${result.error}</p>`
                        };
                        this.showNotification(result.error, 'error');
                    }
                },

                useProspectingScanner() {
                    if (!window.scannerSystem) {
                        this.showNotification('Scanner system not available', 'error');
                        return;
                    }
                    
                    const result = window.scannerSystem.startScan('prospecting', 'stage1', this.player.coordinates);
                    if (result.success) {
                        this.currentView = {
                            title: '‚õèÔ∏è Prospecting Scanner Active',
                            content: `<p class="text-yellow-400">Prospecting scan initiated...</p>
                                     <p class="text-gray-300">Surveying subsurface mineral deposits (1% depth)</p>
                                     <p class="text-yellow-400">Energy consumed: 25 units</p>`
                        };
                        this.showNotification('Prospecting scan started', 'success');
                    } else {
                        this.currentView = {
                            title: '‚õèÔ∏è Prospecting Scanner Error',
                            content: `<p class="text-red-400">Scanner Error: ${result.error}</p>`
                        };
                        this.showNotification(result.error, 'error');
                    }
                },

                useSkimmingScanner() {
                    if (!window.scannerSystem) {
                        this.showNotification('Scanner system not available', 'error');
                        return;
                    }
                    
                    const result = window.scannerSystem.startScan('skimming', 'stage1', this.player.coordinates, 'medium');
                    if (result.success) {
                        this.currentView = {
                            title: 'üí® Atmospheric Skimmer Active',
                            content: `<p class="text-purple-400">Atmospheric scan initiated...</p>
                                     <p class="text-gray-300">Analyzing atmospheric composition at medium altitude</p>
                                     <p class="text-yellow-400">Energy consumed: 10 units</p>`
                        };
                        this.showNotification('Atmospheric scan started', 'success');
                    } else {
                        this.currentView = {
                            title: 'üí® Atmospheric Skimmer Error',
                            content: `<p class="text-red-400">Scanner Error: ${result.error}</p>`
                        };
                        this.showNotification(result.error, 'error');
                    }
                },

                useShipScanner() {
                    if (!window.scannerSystem) {
                        this.showNotification('Scanner system not available', 'error');
                        return;
                    }
                    
                    const result = window.scannerSystem.startScan('ship', 'longRange', this.player.coordinates);
                    if (result.success) {
                        this.currentView = {
                            title: 'üöÄ Ship Scanner Active',
                            content: `<p class="text-red-400">Ship scan initiated...</p>
                                     <p class="text-gray-300">Scanning for vessels in long-range proximity</p>
                                     <p class="text-yellow-400">Energy consumed: 2 units</p>`
                        };
                        this.showNotification('Ship scan started', 'success');
                    } else {
                        this.currentView = {
                            title: 'üöÄ Ship Scanner Error',
                            content: `<p class="text-red-400">Scanner Error: ${result.error}</p>`
                        };
                        this.showNotification(result.error, 'error');
                    }
                },

                performSpatialScan() {
                    setTimeout(() => {
                        this.scannerResults = {
                            visible: true,
                            data: `
                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="bg-gray-800 p-4 rounded-lg">
                                            <h4 class="font-semibold text-blue-400 mb-2">üåü Prime (Main Star)</h4>
                                            <p class="text-sm text-gray-300">G2V-class star, stable fusion reactions detected</p>
                                            <p class="text-xs text-gray-400">Distance: 0.8 AU</p>
                                        </div>
                                        <div class="bg-gray-800 p-4 rounded-lg">
                                            <h4 class="font-semibold text-green-400 mb-2">üåç Keldar (Primary Planet)</h4>
                                            <p class="text-sm text-gray-300">Large terrestrial world, breathable atmosphere</p>
                                            <p class="text-xs text-gray-400">3 moons detected</p>
                                        </div>
                                        <div class="bg-gray-800 p-4 rounded-lg">
                                            <h4 class="font-semibold text-purple-400 mb-2">üõ∞Ô∏è Orbital Platforms</h4>
                                            <p class="text-sm text-gray-300">Multiple artificial satellites and stations</p>
                                            <p class="text-xs text-gray-400">Including current location: Nexus Station</p>
                                        </div>
                                        <div class="bg-gray-800 p-4 rounded-lg">
                                            <h4 class="font-semibold text-orange-400 mb-2">‚ö° Energy Signatures</h4>
                                            <p class="text-sm text-gray-300">Industrial activity detected planetside</p>
                                            <p class="text-xs text-gray-400">Multiple power sources identified</p>
                                        </div>
                                    </div>
                                </div>
                            `
                        };
                    }, 2000);
                },

                // Content Generation Functions
                generateCargoManifest() {
                    const inventory = this.player.inventory || [];
                    if (inventory.length === 0) {
                        return '<p class="text-gray-400">Cargo bay is empty.</p>';
                    }
                    
                    let manifest = '<div class="space-y-2">';
                    inventory.forEach(item => {
                        manifest += `
                            <div class="bg-gray-800 p-3 rounded flex justify-between items-center">
                                <div>
                                    <span class="font-semibold">${item.name}</span>
                                    <span class="text-sm text-gray-400 ml-2">Qty: ${item.quantity}</span>
                                </div>
                                <div class="text-xs text-gray-400">${item.description || 'No description'}</div>
                            </div>
                        `;
                    });
                    manifest += '</div>';
                    return manifest;
                },

                generateCrewInfo() {
                    return `
                        <div class="space-y-4">
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <h4 class="font-semibold text-blue-400 mb-2">üë®‚Äç‚úàÔ∏è Captain</h4>
                                <p class="text-sm text-gray-300">${this.player.username} (You)</p>
                                <p class="text-xs text-gray-400">Ship Command, Navigation, Combat</p>
                            </div>
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <h4 class="font-semibold text-green-400 mb-2">üîß Engineering</h4>
                                <p class="text-sm text-gray-300">Currently hiring - Visit Station Personnel</p>
                                <p class="text-xs text-gray-400">Ship Maintenance, Power Management</p>
                            </div>
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <h4 class="font-semibold text-purple-400 mb-2">üì° Communications</h4>
                                <p class="text-sm text-gray-300">AI Assistant Online</p>
                                <p class="text-xs text-gray-400">Scanner Operations, Data Analysis</p>
                            </div>
                        </div>
                    `;
                },

                generateUpgradesList() {
                    return `
                        <div class="space-y-4">
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <h4 class="font-semibold text-green-400 mb-2">‚úÖ Installed Upgrades</h4>
                                <ul class="text-sm text-gray-300 space-y-1">
                                    <li>‚Ä¢ Basic Life Support System</li>
                                    <li>‚Ä¢ Standard Navigation Computer</li>
                                    <li>‚Ä¢ Emergency Backup Power</li>
                                </ul>
                            </div>
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <h4 class="font-semibold text-yellow-400 mb-2">‚ö†Ô∏è Available Slots</h4>
                                <ul class="text-sm text-gray-300 space-y-1">
                                    <li>‚Ä¢ Weapon Hardpoint (2 available)</li>
                                    <li>‚Ä¢ Utility Module (3 available)</li>
                                    <li>‚Ä¢ Engine Enhancement (1 available)</li>
                                </ul>
                            </div>
                        </div>
                    `;
                },

                generateShipLogs() {
                    return `
                        <div class="space-y-2">
                            <div class="bg-gray-800 p-3 rounded text-sm">
                                <span class="text-green-400">[${new Date().toLocaleString()}]</span>
                                <span class="text-gray-300"> - Docked at Nexus Station</span>
                            </div>
                            <div class="bg-gray-800 p-3 rounded text-sm">
                                <span class="text-blue-400">[Previous Session]</span>
                                <span class="text-gray-300"> - All systems checked, ready for operations</span>
                            </div>
                            <div class="bg-gray-800 p-3 rounded text-sm">
                                <span class="text-purple-400">[System Boot]</span>
                                <span class="text-gray-300"> - Ship AI initialized successfully</span>
                            </div>
                        </div>
                    `;
                },

                // Utility Functions
                savePlayer() {
                    localStorage.setItem('currentPlayer', JSON.stringify(this.player));
                },

                logout() {
                    localStorage.removeItem('currentPlayer');
                    window.location.href = 'index.html';
                },

                showNotification(message, type = 'success') {
                    Toastify({
                        text: message,
                        duration: 3000,
                        close: true,
                        gravity: "top",
                        position: "right",
                        backgroundColor: type === 'success' ? "#10B981" : "#EF4444",
                    }).showToast();
                },

                // Ship Configuration Functions
                configureWeapons() {
                    this.currentView = {
                        title: '‚öîÔ∏è Weapons Systems Configuration',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-red-400 mb-2">üî´ Primary Weapons</h4>
                                    <p class="text-sm text-gray-300">No weapons currently installed</p>
                                    <button class="mt-2 bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm">Configure Targeting</button>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-orange-400 mb-2">üéØ Targeting Systems</h4>
                                    <p class="text-sm text-gray-300">Basic targeting computer online</p>
                                    <p class="text-xs text-gray-400">Accuracy: 85% | Range: 5km</p>
                                </div>
                            </div>
                        `
                    };
                },

                configureCargo() {
                    this.currentView = {
                        title: 'üì¶ Cargo Configuration',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-400 mb-2">üìä Capacity Management</h4>
                                    <p class="text-sm text-gray-300">Current: 25/100 cubic meters</p>
                                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                                        <div class="bg-green-400 h-2 rounded-full" style="width: 25%"></div>
                                    </div>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-400 mb-2">üîí Security Options</h4>
                                    <p class="text-sm text-gray-300">Standard locking mechanisms active</p>
                                    <button class="mt-2 bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm">Upgrade Security</button>
                                </div>
                            </div>
                        `
                    };
                },

                configureShields() {
                    this.currentView = {
                        title: 'üõ°Ô∏è Shield Configuration',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-400 mb-2">‚ö° Power Allocation</h4>
                                    <p class="text-sm text-gray-300">Shield Strength: ${this.player.shieldStrength}%</p>
                                    <input type="range" min="0" max="100" value="${this.player.shieldStrength}" class="w-full mt-2">
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-cyan-400 mb-2">üìª Frequency Tuning</h4>
                                    <p class="text-sm text-gray-300">Standard defensive frequency active</p>
                                    <button class="mt-2 bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm">Cycle Frequencies</button>
                                </div>
                            </div>
                        `
                    };
                },

                configureCommunications() {
                    this.currentView = {
                        title: 'üì° Communications Configuration',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-400 mb-2">üì∂ Range Settings</h4>
                                    <p class="text-sm text-gray-300">Current Range: 50,000 km</p>
                                    <p class="text-xs text-gray-400">Local system coverage active</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-400 mb-2">üîê Encryption</h4>
                                    <p class="text-sm text-gray-300">Standard encryption enabled</p>
                                    <button class="mt-2 bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm">Upgrade Encryption</button>
                                </div>
                            </div>
                        `
                    };
                },

                configureLifeSupport() {
                    this.currentView = {
                        title: 'üí® Life Support Configuration',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-400 mb-2">üå¨Ô∏è Atmosphere</h4>
                                    <p class="text-sm text-gray-300">Oxygen: 21% | Pressure: 1 ATM</p>
                                    <p class="text-xs text-gray-400">All levels nominal</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-orange-400 mb-2">‚ö° Power Management</h4>
                                    <p class="text-sm text-gray-300">Power allocation: 15% of reactor output</p>
                                    <input type="range" min="10" max="30" value="15" class="w-full mt-2">
                                </div>
                            </div>
                        `
                    };
                },

                configureCloaking() {
                    this.currentView = {
                        title: 'üëª Cloaking Device Configuration',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-red-400 mb-2">‚ö†Ô∏è Device Status</h4>
                                    <p class="text-sm text-gray-300">Cloaking device: OFFLINE</p>
                                    <p class="text-xs text-gray-400">Requires military-grade license</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-400 mb-2">‚ö° Power Requirements</h4>
                                    <p class="text-sm text-gray-300">Would require 45% reactor output</p>
                                    <p class="text-xs text-gray-400">Current reactor insufficient</p>
                                </div>
                            </div>
                        `
                    };
                },

                configureNanobots() {
                    this.currentView = {
                        title: 'üîß Auto-Repair Nanobots',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-cyan-400 mb-2">ü§ñ Nanobot Status</h4>
                                    <p class="text-sm text-gray-300">Basic repair nanobots: ACTIVE</p>
                                    <p class="text-xs text-gray-400">Efficiency: 78%</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-orange-400 mb-2">üì¶ Resource Consumption</h4>
                                    <p class="text-sm text-gray-300">Raw materials: 2.3 kg/hour</p>
                                    <button class="mt-2 bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm">Optimize Efficiency</button>
                                </div>
                            </div>
                        `
                    };
                },

                configureGravity() {
                    this.currentView = {
                        title: 'üåç Gravity Field Generator',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-400 mb-2">üåç Gravity Level</h4>
                                    <p class="text-sm text-gray-300">Current: 0.85 G (Earth Standard)</p>
                                    <input type="range" min="0" max="200" value="85" class="w-full mt-2">
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-400 mb-2">‚ö° Power Usage</h4>
                                    <p class="text-sm text-gray-300">12% of reactor output</p>
                                    <p class="text-xs text-gray-400">Stable field maintained</p>
                                </div>
                            </div>
                        `
                    };
                },

                configureSensors() {
                    this.currentView = {
                        title: 'üì° Sensor Range Configuration',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-400 mb-2">üìä Detection Range</h4>
                                    <p class="text-sm text-gray-300">Current: 75,000 km effective range</p>
                                    <p class="text-xs text-gray-400">Standard civilian sensors</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-cyan-400 mb-2">üéØ Detection Capabilities</h4>
                                    <p class="text-sm text-gray-300">Ships, large objects, energy signatures</p>
                                    <button class="mt-2 bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm">Boost Range</button>
                                </div>
                            </div>
                        `
                    };
                },

                configureBlackMarket() {
                    this.currentView = {
                        title: 'üï≥Ô∏è Hidden Compartment',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg border border-red-500">
                                    <h4 class="font-semibold text-red-400 mb-2">‚ö†Ô∏è WARNING</h4>
                                    <p class="text-sm text-gray-300">Hidden compartments are illegal in most systems</p>
                                    <p class="text-xs text-gray-400">Installation requires black market contacts</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-orange-400 mb-2">üì¶ Capacity</h4>
                                    <p class="text-sm text-gray-300">No hidden compartment installed</p>
                                    <p class="text-xs text-gray-400">Would add 5m¬≥ undetectable storage</p>
                                </div>
                            </div>
                        `
                    };
                },

                manageLoadouts() {
                    this.currentView = {
                        title: '‚ö° Ship Loadout Management',
                        content: `
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-gray-800 p-4 rounded-lg border border-blue-500">
                                        <h4 class="font-semibold text-blue-400 mb-2">üî∑ Standard Loadout</h4>
                                        <p class="text-xs text-gray-400 mb-2">Balanced configuration</p>
                                        <ul class="text-xs text-gray-300 space-y-1">
                                            <li>‚Ä¢ Shields: 100%</li>
                                            <li>‚Ä¢ Weapons: Basic</li>
                                            <li>‚Ä¢ Sensors: Standard</li>
                                            <li>‚Ä¢ Cargo: Full capacity</li>
                                        </ul>
                                        <button class="mt-2 bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-xs w-full">Activate</button>
                                    </div>
                                    <div class="bg-gray-800 p-4 rounded-lg border border-red-500">
                                        <h4 class="font-semibold text-red-400 mb-2">‚öîÔ∏è Combat Loadout</h4>
                                        <p class="text-xs text-gray-400 mb-2">Maximum firepower</p>
                                        <ul class="text-xs text-gray-300 space-y-1">
                                            <li>‚Ä¢ Shields: Reinforced</li>
                                            <li>‚Ä¢ Weapons: Enhanced</li>
                                            <li>‚Ä¢ Sensors: Combat mode</li>
                                            <li>‚Ä¢ Cargo: Reduced</li>
                                        </ul>
                                        <button class="mt-2 bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-xs w-full">Activate</button>
                                    </div>
                                    <div class="bg-gray-800 p-4 rounded-lg border border-purple-500">
                                        <h4 class="font-semibold text-purple-400 mb-2">üë§ Stealth Loadout</h4>
                                        <p class="text-xs text-gray-400 mb-2">Minimal signature</p>
                                        <ul class="text-xs text-gray-300 space-y-1">
                                            <li>‚Ä¢ Shields: Minimal</li>
                                            <li>‚Ä¢ Weapons: Concealed</li>
                                            <li>‚Ä¢ Sensors: Passive</li>
                                            <li>‚Ä¢ Cargo: Specialized</li>
                                        </ul>
                                        <button class="mt-2 bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded text-xs w-full">Activate</button>
                                    </div>
                                </div>
                            </div>
                        `
                    };
                },

                // Station Location Functions
                visitEquipmentCenter() {
                    this.currentView = {
                        title: '‚öîÔ∏è Equipment Center',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Browse and purchase ship equipment, weapons, and upgrades.</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-gray-800 p-4 rounded-lg">
                                        <h4 class="font-semibold text-red-400 mb-2">üî´ Weapons</h4>
                                        <p class="text-sm text-gray-300">Combat systems and armaments</p>
                                    </div>
                                    <div class="bg-gray-800 p-4 rounded-lg">
                                        <h4 class="font-semibold text-blue-400 mb-2">üõ†Ô∏è Tools</h4>
                                        <p class="text-sm text-gray-300">Mining and utility equipment</p>
                                    </div>
                                </div>
                            </div>
                        `
                    };
                },

                visitTavern() {
                    this.currentView = {
                        title: 'üç∫ The Stellar Cantina',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">A popular gathering place for traders, miners, and spacers.</p>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-400 mb-2">üí¨ Conversations</h4>
                                    <p class="text-sm text-gray-300">"Did you hear about the new mining operation near the asteroid belt?"</p>
                                    <p class="text-sm text-gray-300">"The government's been asking questions about unlicensed torpedo launches..."</p>
                                </div>
                            </div>
                        `
                    };
                },

                visitGovernment() {
                    this.currentView = {
                        title: 'üèõÔ∏è Government Services',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Official government services, permits, and legal matters.</p>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700" onclick="window.stationAppInstance.showLicensingSystem()">
                                        <h4 class="font-semibold text-blue-400 mb-2">üìã Licensing System</h4>
                                        <p class="text-sm text-gray-300">Apply for professional licenses</p>
                                        <p class="text-xs text-gray-400 mt-1">Click to browse available licenses</p>
                                    </div>
                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700" onclick="window.stationAppInstance.showMyLicenses()">
                                        <h4 class="font-semibold text-green-400 mb-2">‚úÖ My Licenses</h4>
                                        <p class="text-sm text-gray-300">View your current licenses</p>
                                        <p class="text-xs text-gray-400 mt-1">Status: ${this.player.licenses ? Object.keys(this.player.licenses).length : 0} active</p>
                                    </div>
                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700" onclick="window.stationAppInstance.showLegalStatus()">
                                        <h4 class="font-semibold text-red-400 mb-2">‚öñÔ∏è Legal Status</h4>
                                        <p class="text-sm text-gray-300">Violations: ${this.player.violations || 0}</p>
                                        <p class="text-xs text-gray-400 mt-1">Standing: ${this.player.legalStanding || 'Good'}</p>
                                    </div>
                                </div>
                            </div>
                        `
                    };
                },

                checkNews() {
                    this.currentView = {
                        title: 'üì∞ Local News Feed',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-400 mb-2">üìà Market Report</h4>
                                    <p class="text-sm text-gray-300">Rare earth prices up 15% this week due to increased demand</p>
                                    <p class="text-xs text-gray-400">2 hours ago</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-400 mb-2">üöÄ Space Traffic</h4>
                                    <p class="text-sm text-gray-300">Heavy cargo traffic expected near Keldar tonight</p>
                                    <p class="text-xs text-gray-400">4 hours ago</p>
                                </div>
                            </div>
                        `
                    };
                },

                visitManufacturing() {
                    const hasBasicLicense = this.hasLicense('manufacturing_basic');
                    const licenseLevel = this.getManufacturingLevel();
                    
                    this.currentView = {
                        title: 'üè≠ Manufacturing Center',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Custom component creation and advanced manufacturing.</p>
                                
                                ${!hasBasicLicense ? `
                                    <div class="bg-red-900 bg-opacity-30 p-4 rounded-lg border border-red-500">
                                        <h4 class="font-semibold text-red-400 mb-2">‚ö†Ô∏è Manufacturing License Required</h4>
                                        <p class="text-sm text-gray-300">Manufacturing operations require proper licensing. Operating without a license violates Keldar system law.</p>
                                        <button onclick="stationApp().visitGovernment()" class="mt-2 bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">Apply for License</button>
                                    </div>
                                ` : `
                                    <div class="bg-green-900 bg-opacity-30 p-4 rounded-lg border border-green-500">
                                        <h4 class="font-semibold text-green-400 mb-2">‚úÖ Licensed Manufacturing Facility</h4>
                                        <p class="text-sm text-gray-300">Current License: ${licenseLevel}</p>
                                        <p class="text-xs text-gray-400">Efficiency: ${this.getManufacturingEfficiency()}%</p>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="bg-gray-800 p-4 rounded-lg">
                                            <h4 class="font-semibold text-blue-400 mb-2">üîß Available Operations</h4>
                                            <ul class="text-sm text-gray-300 space-y-1">
                                                <li>‚Ä¢ Basic component assembly</li>
                                                <li>‚Ä¢ Ship part manufacturing</li>
                                                <li>‚Ä¢ Equipment modification</li>
                                                ${licenseLevel === 'Master Manufacturer' ? '<li class="text-yellow-400">‚Ä¢ Experimental technology</li>' : ''}
                                            </ul>
                                        </div>
                                        <div class="bg-gray-800 p-4 rounded-lg">
                                            <h4 class="font-semibold text-purple-400 mb-2">üìä Production Stats</h4>
                                            <p class="text-sm text-gray-300">Daily Limit: ${this.getManufacturingLimit()} items</p>
                                            <p class="text-sm text-gray-300">Quality Rating: ${this.getManufacturingQuality()}</p>
                                        </div>
                                    </div>
                                `}
                            </div>
                        `
                    };
                },

                getManufacturingLevel() {
                    if (this.hasLicense('manufacturing_master')) return 'Master Manufacturer';
                    if (this.hasLicense('manufacturing_industrial')) return 'Industrial License';
                    if (this.hasLicense('manufacturing_advanced')) return 'Advanced Production';
                    if (this.hasLicense('manufacturing_standard')) return 'Standard Manufacturing';
                    if (this.hasLicense('manufacturing_basic')) return 'Basic Fabrication';
                    return 'Unlicensed';
                },

                getManufacturingEfficiency() {
                    if (this.hasLicense('manufacturing_master')) return 99;
                    if (this.hasLicense('manufacturing_industrial')) return 98;
                    if (this.hasLicense('manufacturing_advanced')) return 95;
                    if (this.hasLicense('manufacturing_standard')) return 90;
                    if (this.hasLicense('manufacturing_basic')) return 85;
                    return 45; // Unlicensed penalty
                },

                getManufacturingLimit() {
                    if (this.hasLicense('manufacturing_master')) return 'Unlimited';
                    if (this.hasLicense('manufacturing_industrial')) return '100';
                    if (this.hasLicense('manufacturing_advanced')) return '50';
                    if (this.hasLicense('manufacturing_standard')) return '25';
                    if (this.hasLicense('manufacturing_basic')) return '10';
                    return '0 (Unlicensed)';
                },

                getManufacturingQuality() {
                    if (this.hasLicense('manufacturing_master')) return 'Masterwork';
                    if (this.hasLicense('manufacturing_industrial')) return 'Professional';
                    if (this.hasLicense('manufacturing_advanced')) return 'High Quality';
                    if (this.hasLicense('manufacturing_standard')) return 'Standard';
                    if (this.hasLicense('manufacturing_basic')) return 'Basic';
                    return 'Poor (Unlicensed)';
                },

                visitResearch() {
                    this.currentView = {
                        title: 'üî¨ Research Laboratory',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Advanced research and technology development facility.</p>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-400 mb-2">üß™ Active Projects</h4>
                                    <p class="text-sm text-gray-300">Advanced sensor array development</p>
                                    <p class="text-sm text-gray-300">Improved shield frequency analysis</p>
                                </div>
                            </div>
                        `
                    };
                },

                visitAgriculture() {
                    this.currentView = {
                        title: 'üå± Agricultural Center',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Food production and biological resource management.</p>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-400 mb-2">üåæ Current Crops</h4>
                                    <p class="text-sm text-gray-300">Hydroponic vegetables, protein cultures</p>
                                    <p class="text-sm text-gray-300">Yield: 127% of baseline efficiency</p>
                                </div>
                            </div>
                        `
                    };
                },

                visitMuseum() {
                    this.currentView = {
                        title: 'üèõÔ∏è Museum & History Center',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Explore the rich history of the Keldar system and its inhabitants.</p>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-400 mb-2">üìö Featured Exhibit</h4>
                                    <p class="text-sm text-gray-300">"The Great Colonization: First settlers of Keldar"</p>
                                    <p class="text-xs text-gray-400">Interactive holographic display available</p>
                                </div>
                            </div>
                        `
                    };
                },

                visitTemple() {
                    this.currentView = {
                        title: '‚õ™ Temple of the Dog',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">A place of contemplation and... unique spiritual practices.</p>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-yellow-400 mb-2">üêï Daily Blessing</h4>
                                    <p class="text-sm text-gray-300">"May your cargo bay be ever full, and your fuel tanks never empty."</p>
                                    <p class="text-xs text-gray-400">- High Chaplain Barkington</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-400 mb-2">üéµ Evening Service</h4>
                                    <p class="text-sm text-gray-300">Tonight: "Cosmic Howling Session" - 20:00 standard time</p>
                                </div>
                            </div>
                        `
                    };
                },

                // Ship Movement and Operations
                manageMovement() {
                    this.currentView = {
                        title: 'üöÄ Movement Options',
                        content: `
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-gray-800 p-4 rounded-lg">
                                        <h4 class="font-semibold text-blue-400 mb-2">‚ö° Impulse Drive</h4>
                                        <p class="text-sm text-gray-300">Short-range maneuvering</p>
                                        <button class="mt-2 bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm w-full">Engage</button>
                                    </div>
                                    <div class="bg-gray-800 p-4 rounded-lg">
                                        <h4 class="font-semibold text-purple-400 mb-2">üåå Warp Drive</h4>
                                        <p class="text-sm text-gray-300">Faster-than-light travel</p>
                                        <button class="mt-2 bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded text-sm w-full">Charge</button>
                                    </div>
                                    <div class="bg-gray-800 p-4 rounded-lg">
                                        <h4 class="font-semibold text-green-400 mb-2">üîó Docking</h4>
                                        <p class="text-sm text-gray-300">Station/ship docking</p>
                                        <button class="mt-2 bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-sm w-full">Initiate</button>
                                    </div>
                                </div>
                            </div>
                        `
                    };
                },

                manageFuelPower() {
                    this.currentView = {
                        title: '‚ö° Fuel & Power Management',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-orange-400 mb-2">‚õΩ Fuel Status</h4>
                                    <p class="text-sm text-gray-300">Main Tank: ${this.player.fuel}%</p>
                                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                                        <div class="bg-orange-400 h-2 rounded-full" style="width: ${this.player.fuel}%"></div>
                                    </div>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-red-400 mb-2">üîã Reactor Control</h4>
                                    <p class="text-sm text-gray-300">Power Output: ${this.player.powerLevel}%</p>
                                    <button class="mt-2 bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">Emergency Reserves</button>
                                </div>
                            </div>
                        `
                    };
                },

                manageMining() {
                    if (!window.miningSystem) {
                        this.showNotification('Mining system not available', 'error');
                        return;
                    }
                    
                    const nearbyLocations = this.getNearbyMiningLocations();
                    const availableLocations = window.miningSystem.getAvailableLocations();
                    const playerInventory = window.miningSystem.getPlayerInventory('player1');
                    const activeMining = window.miningSystem.getPlayerMiningOperations('player1');
                    
                    this.currentView = {
                        title: '‚õèÔ∏è Mining Operations Center',
                        content: `
                            <div class="space-y-6">
                                <!-- Quick Mining Actions -->
                                <div class="bg-gray-800 p-4 rounded-lg border border-yellow-500">
                                    <h4 class="font-semibold text-yellow-400 mb-3">üöÄ Quick Mining</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <button onclick="getStationApp().quickMine()" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-3 rounded text-sm">
                                            ‚õèÔ∏è Quick Mine
                                        </button>
                                        <button onclick="getStationApp().openMiningInterface()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded text-sm">
                                            üìä Full Interface
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Current Status -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-gray-800 p-4 rounded-lg">
                                        <h4 class="font-semibold text-blue-400 mb-2">üì¶ Cargo Status</h4>
                                        <p class="text-sm text-gray-300">Ore samples: ${playerInventory.length}</p>
                                        <p class="text-xs text-gray-400">Cargo space: ${this.getCargoUsed()}/${this.getMaxCargo()}</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                                            <div class="bg-blue-500 h-2 rounded-full" style="width: ${Math.min(100, (this.getCargoUsed()/this.getMaxCargo())*100)}%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-800 p-4 rounded-lg">
                                        <h4 class="font-semibold text-green-400 mb-2">‚ö° Operations</h4>
                                        <p class="text-sm text-gray-300">Active mining: ${activeMining.length}</p>
                                        <p class="text-xs text-gray-400">Available locations: ${Object.keys(availableLocations).length}</p>
                                        ${activeMining.length > 0 ? 
                                            `<p class="text-yellow-400 text-xs mt-1">‚ö†Ô∏è Mining in progress</p>` : 
                                            `<p class="text-green-400 text-xs mt-1">‚úÖ Ready for mining</p>`
                                        }
                                    </div>
                                </div>
                                
                                <!-- Nearby Locations -->
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-400 mb-3">ÔøΩ Nearby Mining Locations</h4>
                                    <div class="space-y-2">
                                        ${Object.keys(availableLocations).slice(0, 3).map(locationName => {
                                            const location = availableLocations[locationName];
                                            return `
                                                <div class="flex justify-between items-center bg-gray-700 p-3 rounded">
                                                    <div>
                                                        <span class="font-medium text-white">${locationName}</span>
                                                        <p class="text-xs text-gray-400">${location.description}</p>
                                                    </div>
                                                    <div class="text-right">
                                                        <div class="text-green-400 text-sm">${location.availableSpots} spots</div>
                                                        <div class="text-gray-400 text-xs">Level ${location.miningDifficulty}</div>
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                                
                                <!-- Refinery Options -->
                                <div class="bg-gray-800 p-4 rounded-lg border border-purple-500">
                                    <h4 class="font-semibold text-purple-400 mb-3">üè≠ Refinery Services</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <button onclick="getStationApp().showRefineryOptions()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded text-sm">
                                            üî® Build Refinery
                                        </button>
                                        <button onclick="getStationApp().processOre()" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-3 rounded text-sm">
                                            ‚öóÔ∏è Process Ore
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-400 mt-2">Level 1 refinery operations available</p>
                                </div>
                            </div>
                        `
                    };
                },

                // LICENSING SYSTEM FUNCTIONS
                initializeLicenses() {
                    if (!this.player.licenses) this.player.licenses = {};
                    if (!this.player.licenseProgress) this.player.licenseProgress = {};
                    if (!this.player.violations) this.player.violations = 0;
                    if (!this.player.legalStanding) this.player.legalStanding = 'Good';
                    if (!this.player.experience) this.player.experience = {};
                },

                showLicensingSystem() {
                    this.currentView = {
                        title: 'üìã Professional Licensing System',
                        content: `
                            <div class="space-y-6">
                                <p class="text-gray-300">Choose a licensing category to explore available certifications:</p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 border border-blue-500" onclick="stationApp().showManufacturingLicenses()">
                                        <h4 class="font-semibold text-blue-400 mb-2">üè≠ Manufacturing</h4>
                                        <p class="text-sm text-gray-300">5 Tier Progressive System</p>
                                        <p class="text-xs text-gray-400">Moderate Learning Curve</p>
                                        <div class="mt-2 text-xs">
                                            <span class="text-green-400">Basic: 10,000 CR</span><br>
                                            <span class="text-yellow-400">Master: 200,000 CR</span>
                                        </div>
                                    </div>

                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 border border-purple-500" onclick="stationApp().showResearchLicenses()">
                                        <h4 class="font-semibold text-purple-400 mb-2">üî¨ Research</h4>
                                        <p class="text-sm text-gray-300">5 Level Academic System</p>
                                        <p class="text-xs text-gray-400">STEEP Learning Curve</p>
                                        <div class="mt-2 text-xs">
                                            <span class="text-green-400">Assistant: 15,000 CR</span><br>
                                            <span class="text-yellow-400">Director: 300,000 CR</span>
                                        </div>
                                    </div>

                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 border border-orange-500" onclick="stationApp().showTechnologyLicenses()">
                                        <h4 class="font-semibold text-orange-400 mb-2">üõ†Ô∏è Technology</h4>
                                        <p class="text-sm text-gray-300">5 Level Engineering System</p>
                                        <p class="text-xs text-gray-400">STEEP Learning Curve</p>
                                        <div class="mt-2 text-xs">
                                            <span class="text-green-400">Technician: 8,000 CR</span><br>
                                            <span class="text-yellow-400">Master: 180,000 CR</span>
                                        </div>
                                    </div>

                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 border border-green-500" onclick="stationApp().showMedicalLicenses()">
                                        <h4 class="font-semibold text-green-400 mb-2">üè• Medical</h4>
                                        <p class="text-sm text-gray-300">6 License Specialty System</p>
                                        <p class="text-xs text-gray-400">EXTREMELY STEEP Curve</p>
                                        <div class="mt-2 text-xs">
                                            <span class="text-green-400">Standard: 75,000 CR</span><br>
                                            <span class="text-yellow-400">Xenobiologist: 750,000 CR</span>
                                        </div>
                                    </div>

                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 border border-red-500" onclick="stationApp().showCombatLicenses()">
                                        <h4 class="font-semibold text-red-400 mb-2">‚öîÔ∏è Combat</h4>
                                        <p class="text-sm text-gray-300">Military Service Required</p>
                                        <p class="text-xs text-gray-400">EXTREMELY STEEP Curve</p>
                                        <div class="mt-2 text-xs">
                                            <span class="text-green-400">Service: 6 months</span><br>
                                            <span class="text-yellow-400">Officer: 2+ years</span>
                                        </div>
                                    </div>

                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 border border-cyan-500" onclick="stationApp().showPilotLicenses()">
                                        <h4 class="font-semibold text-cyan-400 mb-2">‚úàÔ∏è Pilot</h4>
                                        <p class="text-sm text-gray-300">5 Class Progressive System</p>
                                        <p class="text-xs text-gray-400">Foundation Learning Curve</p>
                                        <div class="mt-2 text-xs">
                                            <span class="text-green-400">Class E: 5,000 CR</span><br>
                                            <span class="text-yellow-400">Class A: 150,000 CR</span>
                                        </div>
                                    </div>

                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 border border-yellow-500" onclick="stationApp().showMiningLicenses()">
                                        <h4 class="font-semibold text-yellow-400 mb-2">‚õèÔ∏è Mining</h4>
                                        <p class="text-sm text-gray-300">12 Specialized Permits</p>
                                        <p class="text-xs text-gray-400">STEEP Learning Curve</p>
                                        <div class="mt-2 text-xs">
                                            <span class="text-green-400">Surface: 15,000 CR</span><br>
                                            <span class="text-yellow-400">Exotic: 200,000 CR</span>
                                        </div>
                                    </div>

                                    <div class="bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 border border-purple-600" onclick="stationApp().showTorpedoLicenses()">
                                        <h4 class="font-semibold text-purple-300 mb-2">üöÄ Torpedo</h4>
                                        <p class="text-sm text-gray-300">8 Type Specialized System</p>
                                        <p class="text-xs text-gray-400">Advanced Prerequisites</p>
                                        <div class="mt-2 text-xs">
                                            <span class="text-green-400">Planetary: 25,000 CR</span><br>
                                            <span class="text-yellow-400">Solar System: 500,000 CR</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-gray-800 p-4 rounded-lg border border-red-500">
                                    <h4 class="font-semibold text-red-400 mb-2">‚ö†Ô∏è Legal Warning</h4>
                                    <p class="text-sm text-gray-300">Operating without proper licenses violates Keldar system law:</p>
                                    <ul class="text-xs text-gray-400 mt-2 space-y-1">
                                        <li>‚Ä¢ <strong>First Violation:</strong> Official warning</li>
                                        <li>‚Ä¢ <strong>Second Violation:</strong> Temporary activity ban</li>
                                        <li>‚Ä¢ <strong>Third Violation:</strong> <span class="text-red-400 font-bold">PERMANENT FORFEITURE</span> of all assets</li>
                                    </ul>
                                    <p class="text-xs text-gray-300 mt-2">All violations reviewed by Player Legal Board</p>
                                </div>
                            </div>
                        `
                    };
                },

                showMyLicenses() {
                    const licenses = this.player.licenses || {};
                    const licenseCount = Object.keys(licenses).length;
                    
                    let licenseList = '';
                    if (licenseCount === 0) {
                        licenseList = '<p class="text-gray-400 text-center py-8">No licenses currently held</p>';
                    } else {
                        licenseList = '<div class="space-y-3">';
                        Object.entries(licenses).forEach(([key, license]) => {
                            const statusColor = license.status === 'active' ? 'text-green-400' : 'text-yellow-400';
                            licenseList += `
                                <div class="bg-gray-800 p-4 rounded-lg border border-gray-600">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h5 class="font-semibold text-blue-400">${license.name}</h5>
                                            <p class="text-sm text-gray-300">${license.category}</p>
                                            <p class="text-xs text-gray-400">Issued: ${license.issueDate}</p>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs ${statusColor} font-semibold">${license.status.toUpperCase()}</span>
                                            ${license.expiryDate ? `<p class="text-xs text-gray-400">Expires: ${license.expiryDate}</p>` : ''}
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        licenseList += '</div>';
                    }

                    this.currentView = {
                        title: '‚úÖ My Professional Licenses',
                        content: `
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-lg font-semibold">Active Licenses: ${licenseCount}</h3>
                                    <button onclick="stationApp().showLicensingSystem()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-sm">Apply for More</button>
                                </div>
                                ${licenseList}
                            </div>
                        `
                    };
                },

                showLegalStatus() {
                    const standing = this.player.legalStanding || 'Good';
                    const violations = this.player.violations || 0;
                    const warningCount = this.player.warningCount || 0;
                    
                    let statusColor = 'text-green-400';
                    let statusIcon = '‚úÖ';
                    if (violations > 0) {
                        statusColor = 'text-yellow-400';
                        statusIcon = '‚ö†Ô∏è';
                    }
                    if (violations >= 2) {
                        statusColor = 'text-red-400';
                        statusIcon = 'üö®';
                    }

                    this.currentView = {
                        title: '‚öñÔ∏è Legal Status Report',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-6 rounded-lg border border-gray-600">
                                    <div class="text-center">
                                        <div class="text-4xl mb-4">${statusIcon}</div>
                                        <h3 class="text-xl font-bold ${statusColor} mb-2">Legal Standing: ${standing}</h3>
                                        <p class="text-gray-300">Total Violations: ${violations}</p>
                                        <p class="text-gray-400 text-sm">Warnings Issued: ${warningCount}</p>
                                    </div>
                                </div>

                                <div class="bg-gray-800 p-4 rounded-lg border border-blue-500">
                                    <h4 class="font-semibold text-blue-400 mb-2">üìã Violation History</h4>
                                    ${violations === 0 ? 
                                        '<p class="text-green-400 text-sm">No violations on record - Exemplary citizen</p>' :
                                        '<p class="text-yellow-400 text-sm">Previous violations recorded - Maintain compliance</p>'
                                    }
                                </div>

                                <div class="bg-gray-800 p-4 rounded-lg border border-red-500">
                                    <h4 class="font-semibold text-red-400 mb-2">‚ö†Ô∏è Consequences</h4>
                                    <div class="text-sm text-gray-300 space-y-1">
                                        <p><strong>Next Violation Level:</strong> ${violations === 0 ? 'Warning' : violations === 1 ? 'Temporary Ban' : 'PERMANENT FORFEITURE'}</p>
                                        <p><strong>Review Authority:</strong> Player Legal Board</p>
                                        <p><strong>Appeal Process:</strong> ${violations < 2 ? 'Limited appeals available' : 'No appeals for final violations'}</p>
                                    </div>
                                </div>

                                ${violations >= 1 ? `
                                    <div class="bg-red-900 bg-opacity-50 p-4 rounded-lg border border-red-500">
                                        <h4 class="font-semibold text-red-400 mb-2">üö® WARNING</h4>
                                        <p class="text-red-300 text-sm">You are ${violations === 1 ? 'one violation away from temporary ban' : 'ONE VIOLATION AWAY FROM PERMANENT FORFEITURE'}!</p>
                                        <p class="text-gray-400 text-xs mt-2">Ensure all operations comply with licensing requirements</p>
                                    </div>
                                ` : ''}
                            </div>
                        `
                    };
                },

                // License Application Functions
                applyForLicense(licenseType, licenseName, cost, requirements) {
                    console.log('Applying for license:', {licenseType, licenseName, cost, requirements});
                    
                    if (this.player.credits < cost) {
                        this.showNotification(`Insufficient credits. Need ${cost.toLocaleString()} CR`, 'error');
                        return;
                    }

                    if (!this.checkLicenseRequirements(requirements)) {
                        this.showNotification('Requirements not met for this license', 'error');
                        return;
                    }

                    // Deduct cost
                    this.player.credits -= cost;
                    
                    // Add license
                    if (!this.player.licenses) this.player.licenses = {};
                    this.player.licenses[licenseType] = {
                        name: licenseName,
                        category: licenseType.split('_')[0],
                        status: 'active',
                        issueDate: new Date().toLocaleDateString(),
                        cost: cost
                    };

                    this.savePlayer();
                    this.showNotification(`${licenseName} acquired successfully!`, 'success');
                    
                    // Refresh the current view
                    this.showMyLicenses();
                },

                checkLicenseRequirements(requirements) {
                    // For now, simplified requirement checking
                    // In a full implementation, this would check various player stats
                    
                    // Check for prerequisite licenses
                    if (requirements.prerequisiteLicense) {
                        if (!this.hasLicense(requirements.prerequisiteLicense)) {
                            console.log('Missing prerequisite license:', requirements.prerequisiteLicense);
                            return false;
                        }
                    }
                    
                    // Check reputation (simplified)
                    if (requirements.reputation && (this.player.reputation || 0) < requirements.reputation) {
                        console.log('Insufficient reputation');
                        return false;
                    }
                    
                    // Check experience (simplified)
                    if (requirements.experience && (this.player.experienceDays || 0) < requirements.experience) {
                        console.log('Insufficient experience');
                        return false;
                    }
                    
                    return true;
                },

                hasLicense(licenseType) {
                    return this.player.licenses && 
                           this.player.licenses[licenseType] && 
                           this.player.licenses[licenseType].status === 'active';
                },

                // Manufacturing Licenses
                showManufacturingLicenses() {
                    this.currentView = {
                        title: 'üè≠ Manufacturing Licenses',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Progressive manufacturing certification system - each tier unlocks advanced capabilities.</p>
                                
                                <div class="space-y-4">
                                    ${this.generateLicenseCard(
                                        'manufacturing_basic',
                                        'Basic Fabrication License',
                                        10000,
                                        'Basic component assembly, 85% efficiency',
                                        {reputation: 0},
                                        'Moderate'
                                    )}
                                    
                                    ${this.generateLicenseCard(
                                        'manufacturing_standard',
                                        'Standard Manufacturing License',
                                        25000,
                                        'Intermediate components, private booth rental, 90% efficiency',
                                        {prerequisiteLicense: 'manufacturing_basic', experience: 30},
                                        'Moderate'
                                    )}
                                    
                                    ${this.generateLicenseCard(
                                        'manufacturing_advanced',
                                        'Advanced Production License',
                                        50000,
                                        'Complex systems, custom blueprints, 95% efficiency',
                                        {prerequisiteLicense: 'manufacturing_standard', experience: 60},
                                        'Challenging'
                                    )}
                                    
                                    ${this.generateLicenseCard(
                                        'manufacturing_industrial',
                                        'Industrial Manufacturing License',
                                        100000,
                                        'Ship modules, hazardous materials, 98% efficiency',
                                        {prerequisiteLicense: 'manufacturing_advanced', experience: 180, reputation: 1000},
                                        'Steep'
                                    )}
                                    
                                    ${this.generateLicenseCard(
                                        'manufacturing_master',
                                        'Master Manufacturer License',
                                        200000,
                                        'Experimental tech, military components, 99% efficiency',
                                        {prerequisiteLicense: 'manufacturing_industrial', experience: 365, reputation: 2000},
                                        'Master Level'
                                    )}
                                </div>
                            </div>
                        `
                    };
                },

                generateLicenseCard(licenseType, name, cost, description, requirements, difficulty) {
                    const hasLicense = this.hasLicense(licenseType);
                    const canAfford = this.player.credits >= cost;
                    const meetsRequirements = this.checkLicenseRequirements(requirements);
                    const canApply = !hasLicense && canAfford && meetsRequirements;
                    
                    let statusIndicator = '';
                    let buttonText = 'Apply';
                    let buttonClass = 'bg-blue-600 hover:bg-blue-700';
                    let buttonDisabled = '';
                    let onclickHandler = '';
                    
                    if (hasLicense) {
                        statusIndicator = '<span class="text-green-400 font-semibold">‚úÖ OWNED</span>';
                        buttonText = 'Owned';
                        buttonClass = 'bg-green-600';
                        buttonDisabled = 'disabled';
                        onclickHandler = '';
                    } else if (!canAfford) {
                        statusIndicator = '<span class="text-red-400 font-semibold">üí∞ Insufficient Credits</span>';
                        buttonText = 'Cannot Afford';
                        buttonClass = 'bg-gray-600';
                        buttonDisabled = 'disabled';
                        onclickHandler = '';
                    } else if (!meetsRequirements) {
                        statusIndicator = '<span class="text-yellow-400 font-semibold">‚ö†Ô∏è Requirements Not Met</span>';
                        buttonText = 'Requires Prerequisites';
                        buttonClass = 'bg-gray-600';
                        buttonDisabled = 'disabled';
                        onclickHandler = '';
                    } else {
                        // Escape quotes for JSON string
                        const requirementsJson = JSON.stringify(requirements).replace(/"/g, '&quot;');
                        onclickHandler = `onclick="window.stationAppInstance.applyForLicense('${licenseType}', '${name}', ${cost}, ${requirementsJson})"`;
                    }

                    return `
                        <div class="bg-gray-800 p-4 rounded-lg border border-gray-600">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-semibold text-blue-400">${name}</h4>
                                    <p class="text-sm text-gray-300">${description}</p>
                                    <p class="text-xs text-gray-400 mt-1">Difficulty: ${difficulty}</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-yellow-400 font-mono">${cost.toLocaleString()} CR</div>
                                    ${statusIndicator}
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <div class="text-xs text-gray-400">
                                    ${Object.entries(requirements).map(([key, value]) => {
                                        if (key === 'prerequisiteLicense') return `Requires: ${value.replace('_', ' ')}`;
                                        if (key === 'experience') return `Experience: ${value} days`;
                                        if (key === 'reputation') return `Reputation: ${value}`;
                                        return '';
                                    }).filter(Boolean).join(' ‚Ä¢ ')}
                                </div>
                                <button 
                                    ${onclickHandler}
                                    class="${buttonClass} px-4 py-2 rounded text-sm transition-colors ${buttonDisabled}"
                                    ${buttonDisabled}
                                >
                                    ${buttonText}
                                </button>
                            </div>
                        </div>
                    `;
                },

                // Medical Licenses
                showMedicalLicenses() {
                    this.currentView = {
                        title: 'üè• Medical Licenses',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Medical licensing requires extensive training and carries extreme responsibility. Learning curve is EXTREMELY STEEP.</p>
                                
                                <div class="bg-red-900 bg-opacity-30 p-4 rounded-lg border border-red-500 mb-4">
                                    <h4 class="font-semibold text-red-400 mb-2">‚ö†Ô∏è Medical Responsibility Warning</h4>
                                    <p class="text-sm text-gray-300">Medical practice involves life and death decisions. Improper medical procedures can result in immediate license revocation and criminal charges.</p>
                                </div>
                                
                                <div class="space-y-4">
                                    <h5 class="text-lg font-semibold text-green-400">Standard Medical Practice</h5>
                                    ${this.generateLicenseCard(
                                        'medical_standard',
                                        'Standard Medical Practice License',
                                        75000,
                                        'Ship medical bays, standard treatments, basic surgery',
                                        {education: 'medical_degree', experience: 180},
                                        'EXTREMELY STEEP'
                                    )}
                                    
                                    <h5 class="text-lg font-semibold text-orange-400">Experimental Medicine</h5>
                                    ${this.generateLicenseCard(
                                        'medical_experimental',
                                        'Experimental Medicine Certification',
                                        150000,
                                        'Untested treatments, clinical trials, research protocols',
                                        {prerequisiteLicense: 'medical_standard', experience: 730, ethics: 'board_approval'},
                                        'MASTER LEVEL'
                                    )}
                                    
                                    ${this.generateLicenseCard(
                                        'medical_advanced_experimental',
                                        'Advanced Experimental Medicine',
                                        300000,
                                        'Revolutionary treatments, genetic modification, life extension',
                                        {prerequisiteLicense: 'medical_experimental', experience: 1825, reputation: 3000},
                                        'LEGENDARY'
                                    )}
                                    
                                    <h5 class="text-lg font-semibold text-purple-400">Alien Pathology (Future Content)</h5>
                                    ${this.generateLicenseCard(
                                        'medical_xenobiology',
                                        'Basic Xenobiology License',
                                        200000,
                                        'Alien specimen examination, contamination protocols',
                                        {prerequisiteLicense: 'medical_standard', security: 'alien_clearance'},
                                        'EXTREMELY STEEP'
                                    )}
                                    
                                    ${this.generateLicenseCard(
                                        'medical_xenopathology',
                                        'Advanced Xenopathology License',
                                        400000,
                                        'Live alien treatment, cross-species research',
                                        {prerequisiteLicense: 'medical_xenobiology', experience: 1095},
                                        'MASTER LEVEL'
                                    )}
                                    
                                    ${this.generateLicenseCard(
                                        'medical_master_xenobiologist',
                                        'Master Xenobiologist License',
                                        750000,
                                        'First contact protocols, galactic medical authority',
                                        {prerequisiteLicense: 'medical_xenopathology', council: 'galactic_approval'},
                                        'LEGENDARY'
                                    )}
                                </div>
                            </div>
                        `
                    };
                },

                // Combat Licenses
                showCombatLicenses() {
                    this.currentView = {
                        title: '‚öîÔ∏è Combat Licenses',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-red-900 bg-opacity-30 p-4 rounded-lg border border-red-500 mb-4">
                                    <h4 class="font-semibold text-red-400 mb-2">üéñÔ∏è MILITARY SERVICE REQUIRED</h4>
                                    <p class="text-sm text-gray-300">All combat licenses require completion of mandatory 6-month military service. No exceptions.</p>
                                    <p class="text-xs text-gray-400 mt-2">Learning curve is EXTREMELY STEEP due to life-and-death nature of combat operations.</p>
                                </div>
                                
                                <div class="space-y-4">
                                    ${this.generateMilitaryServiceCard()}
                                    
                                    <h5 class="text-lg font-semibold text-blue-400">Career Specialization Paths</h5>
                                    ${this.generateLicenseCard(
                                        'combat_government',
                                        'Government Security License',
                                        0,
                                        'Government facilities, VIP protection, state law enforcement',
                                        {military: 'honorable_discharge', clearance: 'security'},
                                        'EXTREMELY STEEP'
                                    )}
                                    
                                    ${this.generateLicenseCard(
                                        'combat_faction',
                                        'Faction Security License',
                                        0,
                                        'Corporate security, private military, faction defense',
                                        {military: 'discharge', sponsor: 'faction'},
                                        'EXTREMELY STEEP'
                                    )}
                                    
                                    ${this.generateLicenseCard(
                                        'combat_corporate',
                                        'Corporate Security License',
                                        0,
                                        'Industrial protection, executive security, intelligence',
                                        {military: 'discharge', sponsor: 'corporation'},
                                        'EXTREMELY STEEP'
                                    )}
                                    
                                    <h5 class="text-lg font-semibold text-red-400">Advanced Military (Future Alien Response)</h5>
                                    ${this.generateLicenseCard(
                                        'combat_officer',
                                        'Military Officer Commission',
                                        0,
                                        'Unit command, strategic planning, alien warfare leadership',
                                        {military: 'exceptional_service', leadership: 'assessment'},
                                        'MASTER LEVEL'
                                    )}
                                </div>
                            </div>
                        `
                    };
                },

                generateMilitaryServiceCard() {
                    const hasService = this.player.militaryService || false;
                    return `
                        <div class="bg-gray-800 p-4 rounded-lg border border-red-600">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-semibold text-red-400">üéñÔ∏è Military Service Requirement</h4>
                                    <p class="text-sm text-gray-300">6-month mandatory service commitment</p>
                                    <p class="text-xs text-gray-400 mt-1">Combat training, discipline, weapons certification</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-yellow-400 font-mono">6 Months</div>
                                    ${hasService ? 
                                        '<span class="text-green-400 font-semibold">‚úÖ COMPLETED</span>' :
                                        '<span class="text-red-400 font-semibold">‚ùå REQUIRED</span>'
                                    }
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <div class="text-xs text-gray-400">
                                    Prerequisites: Age 18+, Physical fitness, Clean legal record
                                </div>
                                <button 
                                    onclick="stationApp().${hasService ? 'showMilitaryRecord' : 'enlistMilitary'}()"
                                    class="${hasService ? 'bg-green-600' : 'bg-red-600 hover:bg-red-700'} px-4 py-2 rounded text-sm transition-colors"
                                >
                                    ${hasService ? 'View Service Record' : 'Enlist Now'}
                                </button>
                            </div>
                        </div>
                    `;
                },

                // Mining, Technology, Pilot, Research, and Torpedo License functions
                showMiningLicenses() {
                    this.currentView = {
                        title: '‚õèÔ∏è Mining Licenses',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Specialized mining permits for different environments and materials. STEEP learning curve due to safety requirements.</p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="space-y-3">
                                        <h5 class="text-lg font-semibold text-orange-400">Stellar Mining</h5>
                                        ${this.generateLicenseCard('mining_solar', 'Solar Collection Permit', 25000, 'Solar energy, plasma harvesting', {safety: 'radiation_course'}, 'STEEP')}
                                        ${this.generateLicenseCard('mining_corona', 'Corona Diving License', 100000, 'Stellar corona material extraction', {prerequisiteLicense: 'mining_solar', training: 'extreme_environment'}, 'EXTREMELY STEEP')}
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <h5 class="text-lg font-semibold text-green-400">Planetary Mining</h5>
                                        ${this.generateLicenseCard('mining_surface', 'Surface Mining Permit', 15000, 'Open-pit mining, surface extraction', {assessment: 'environmental_impact'}, 'STEEP')}
                                        ${this.generateLicenseCard('mining_deep', 'Deep Core License', 50000, 'Deep drilling, rare earth extraction', {certification: 'geological_survey'}, 'EXTREMELY STEEP')}
                                    </div>
                                </div>
                            </div>
                        `
                    };
                },

                showTorpedoLicenses() {
                    this.currentView = {
                        title: 'üöÄ Torpedo Construction Licenses',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Specialized torpedo construction and deployment licenses. Each type requires specific permits and approvals.</p>
                                
                                <div class="bg-yellow-900 bg-opacity-30 p-4 rounded-lg border border-yellow-500 mb-4">
                                    <h4 class="font-semibold text-yellow-400 mb-2">‚ö†Ô∏è Construction Regulations</h4>
                                    <p class="text-sm text-gray-300">Torpedo construction in populated areas (like Nexus Station) is strictly prohibited. Deep space construction requires additional permits.</p>
                                </div>
                                
                                <div class="space-y-4">
                                    ${this.generateLicenseCard('torpedo_planetary', 'Planetary Genesis Permit', 25000, 'Standard planet creation (100km-10,000km)', {license: 'manufacturing_basic', permit: 'environmental'}, 'Challenging')}
                                    ${this.generateLicenseCard('torpedo_large_planetary', 'Large Planetary Genesis', 75000, 'Massive planets (10,000km-50,000km)', {license: 'manufacturing_advanced', review: 'government'}, 'Steep')}
                                    ${this.generateLicenseCard('torpedo_solar_system', 'Solar System Genesis', 500000, 'Complete solar system creation', {license: 'manufacturing_master', approval: 'diplomatic'}, 'MASTER LEVEL')}
                                    ${this.generateLicenseCard('torpedo_communications', 'Communications Satellite', 35000, 'Deep space communication relays', {license: 'technology_2', permit: 'spectrum'}, 'Moderate')}
                                    ${this.generateLicenseCard('torpedo_defense', 'Defense Satellite', 100000, 'Automated defense platforms', {clearance: 'military', approval: 'strategic'}, 'EXTREMELY STEEP')}
                                    ${this.generateLicenseCard('torpedo_mining', 'Mining Prospecting', 45000, 'Survey and extraction platforms', {license: 'mining_surface', permit: 'resource_rights'}, 'Steep')}
                                    ${this.generateLicenseCard('torpedo_probe', 'Deep Space Probe', 55000, 'Long-range exploration missions', {license: 'research_3', approval: 'scientific'}, 'Challenging')}
                                    ${this.generateLicenseCard('torpedo_surveillance', 'Surveillance Platform', 60000, 'Covert monitoring systems', {clearance: 'security', approval: 'judicial'}, 'EXTREMELY STEEP')}
                                </div>
                            </div>
                        `
                    };
                },

                // Additional license functions and violation system
                warnUnlicensedMining() {
                    this.showNotification('WARNING: Unlicensed mining detected! Legal violation recorded.', 'error');
                    this.recordViolation('Unlicensed mining operation');
                },

                performMining() {
                    this.showNotification('Mining operation initiated successfully', 'success');
                    // Add actual mining logic here
                },

                recordViolation(description) {
                    if (!this.player.violations) this.player.violations = 0;
                    if (!this.player.violationHistory) this.player.violationHistory = [];
                    
                    this.player.violations += 1;
                    this.player.violationHistory.push({
                        description: description,
                        date: new Date().toLocaleDateString(),
                        consequence: this.getViolationConsequence(this.player.violations)
                    });

                    // Update legal standing
                    if (this.player.violations === 1) {
                        this.player.legalStanding = 'Warning Issued';
                    } else if (this.player.violations === 2) {
                        this.player.legalStanding = 'Temporary Ban';
                    } else if (this.player.violations >= 3) {
                        this.player.legalStanding = 'ASSETS FORFEITED';
                    }

                    this.savePlayer();
                    
                    setTimeout(() => {
                        this.showNotification(this.getViolationConsequence(this.player.violations), 'error');
                    }, 1000);
                },

                getViolationConsequence(violationCount) {
                    switch(violationCount) {
                        case 1: return 'FIRST VIOLATION: Official warning issued. Future violations will result in severe penalties.';
                        case 2: return 'SECOND VIOLATION: Temporary ban from licensed activities. One more violation will result in permanent asset forfeiture.';
                        case 3: return 'THIRD VIOLATION: PERMANENT FORFEITURE OF ALL ASSETS. Game over.';
                        default: return 'Multiple violations detected. Legal review required.';
                    }
                },

                // Additional license category functions
                showResearchLicenses() {
                    this.currentView = {
                        title: 'üî¨ Research Licenses',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Academic research licensing system with STEEP learning curves. Each level requires extensive study and peer review.</p>
                                
                                <div class="space-y-4">
                                    ${this.generateLicenseCard('research_assistant', 'Research Assistant Certification', 15000, 'Basic research access, 50% efficiency', {education: 'academic_credentials'}, 'STEEP')}
                                    ${this.generateLicenseCard('research_junior', 'Junior Researcher License', 30000, 'Independent experiments, 75% efficiency', {prerequisiteLicense: 'research_assistant', experience: 45}, 'STEEP')}
                                    ${this.generateLicenseCard('research_senior', 'Senior Researcher License', 75000, 'Advanced protocols, team leadership, 100% efficiency', {prerequisiteLicense: 'research_junior', experience: 90}, 'EXTREMELY STEEP')}
                                    ${this.generateLicenseCard('research_principal', 'Principal Researcher License', 150000, 'Cutting-edge projects, 125% efficiency', {prerequisiteLicense: 'research_senior', experience: 180}, 'MASTER LEVEL')}
                                    ${this.generateLicenseCard('research_director', 'Research Director License', 300000, 'Unlimited facility access, 150% efficiency', {prerequisiteLicense: 'research_principal', experience: 730}, 'LEGENDARY')}
                                </div>
                            </div>
                        `
                    };
                },

                showTechnologyLicenses() {
                    this.currentView = {
                        title: 'üõ†Ô∏è Technology Licenses',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Engineering and technology certification with STEEP learning curves. Focus on system repair and innovation.</p>
                                
                                <div class="space-y-4">
                                    ${this.generateLicenseCard('tech_basic', 'Basic Systems Technician', 8000, 'Standard maintenance, 70% speed, 85% success', {assessment: 'technical_aptitude'}, 'STEEP')}
                                    ${this.generateLicenseCard('tech_advanced', 'Advanced Systems Specialist', 20000, 'Complex integration, 85% speed, 92% success', {prerequisiteLicense: 'tech_basic', experience: 30}, 'STEEP')}
                                    ${this.generateLicenseCard('tech_engineer', 'Engineering Officer', 45000, 'System design, 100% speed, 96% success', {prerequisiteLicense: 'tech_advanced', education: 'engineering_degree'}, 'EXTREMELY STEEP')}
                                    ${this.generateLicenseCard('tech_chief', 'Chief Technology Officer', 90000, 'Architecture planning, 115% speed, 98% success', {prerequisiteLicense: 'tech_engineer', training: 'management'}, 'MASTER LEVEL')}
                                    ${this.generateLicenseCard('tech_master', 'Master Engineer', 180000, 'Industry standards, 130% speed, 99% success', {prerequisiteLicense: 'tech_chief', contribution: 'major_innovation'}, 'LEGENDARY')}
                                </div>
                            </div>
                        `
                    };
                },

                showPilotLicenses() {
                    this.currentView = {
                        title: '‚úàÔ∏è Pilot Licenses',
                        content: `
                            <div class="space-y-4">
                                <p class="text-gray-300">Progressive pilot certification system. Foundation learning curve - gateway to other specializations.</p>
                                
                                <div class="space-y-4">
                                    ${this.generateLicenseCard('pilot_e', 'Class E: Basic Pilot License', 5000, 'Small civilian craft, local system only', {age: 18, medical: 'clearance'}, 'Foundation')}
                                    ${this.generateLicenseCard('pilot_d', 'Class D: Standard Commercial', 12000, 'Medium commercial vessels, night flying', {prerequisiteLicense: 'pilot_e', hours: 100}, 'Foundation')}
                                    ${this.generateLicenseCard('pilot_c', 'Class C: Advanced Commercial', 30000, 'Large commercial, inter-system travel', {prerequisiteLicense: 'pilot_d', hours: 500}, 'Moderate')}
                                    ${this.generateLicenseCard('pilot_b', 'Class B: Military/Heavy Industrial', 75000, 'Military vessels, combat authorization', {prerequisiteLicense: 'pilot_c', clearance: 'security'}, 'Challenging')}
                                    ${this.generateLicenseCard('pilot_a', 'Class A: Master Pilot License', 150000, 'Unlimited operations, instructor rights', {prerequisiteLicense: 'pilot_b', hours: 2000}, 'Steep')}
                                </div>
                            </div>
                        `
                    };
                },
                
                // Scanner and Mining System Integration
                initializeScannersAndMining() {
                    // Initialize global systems
                    if (typeof ScannerSystem !== 'undefined') {
                        window.scannerSystem = new ScannerSystem();
                        window.scannerSystem.updatePlayerLocation(0, 0, 0);
                        window.scannerSystem.updateShipState('docked');
                        
                        // Listen for scan completion
                        window.addEventListener('scanComplete', (event) => {
                            this.handleScanComplete(event.detail);
                        });
                    }
                    
                    if (typeof MiningSystem !== 'undefined') {
                        window.miningSystem = new MiningSystem();
                        
                        // Listen for mining completion
                        window.addEventListener('miningComplete', (event) => {
                            this.handleMiningComplete(event.detail);
                        });
                    }
                    
                    if (typeof ShipEquipment !== 'undefined') {
                        window.shipEquipment = new ShipEquipment();
                    }
                    
                    // Set default coordinates if not present
                    if (!this.player.coordinates) {
                        this.player.coordinates = { x: 0, y: 0, z: 0 };
                    }
                },
                
                handleScanComplete(scanData) {
                    this.showNotification(`Scan completed! Found ${scanData.results.objectsDetected || 'data'} results.`, 'success');
                    
                    // Update current view if we're showing a scanner
                    if (this.currentView.title.includes('Scanner')) {
                        this.currentView.content = this.formatScanResults(scanData.results);
                    }
                },
                
                handleMiningComplete(miningData) {
                    this.showNotification(`Mining completed! Found ${miningData.oreYield.length} ore samples.`, 'success');
                    
                    // Update credits if needed
                    if (!this.player.credits) this.player.credits = 0;
                    this.savePlayer();
                },
                
                formatScanResults(results) {
                    if (results.scanType === 'spatial' && results.objects) {
                        return `
                            <div class="space-y-4">
                                <h4 class="text-blue-400 font-semibold">Objects Detected: ${results.objectsDetected}</h4>
                                <div class="grid gap-3">
                                    ${results.objects.map(obj => `
                                        <div class="bg-gray-800 p-3 rounded border-l-4 border-blue-500">
                                            <div class="flex justify-between">
                                                <div>
                                                    <h5 class="font-medium text-white">${obj.type}</h5>
                                                    <p class="text-sm text-gray-400">${obj.classification}</p>
                                                </div>
                                                <div class="text-right text-sm">
                                                    <div class="text-cyan-400">Distance: ${obj.distance.toFixed(1)}</div>
                                                    <div class="text-gray-400">Signature: ${obj.signature}</div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    } else {
                        return `<pre class="bg-gray-800 p-4 rounded text-sm text-gray-300 overflow-x-auto">${JSON.stringify(results, null, 2)}</pre>`;
                    }
                },
                
                // Mining helper functions
                quickMine() {
                    if (!window.miningSystem) {
                        this.showNotification('Mining system not available', 'error');
                        return;
                    }
                    
                    // Try to mine at nearest location (Quilt Belt by default)
                    const result = window.miningSystem.startMining('player1', 
                        { type: 'Scout Ship', energy: 85 }, 
                        'Quilt Belt', 1);
                    
                    if (result.success) {
                        this.showNotification(result.message, 'success');
                        // Update view to show mining status
                        this.manageMining();
                    } else {
                        this.showNotification(`Mining failed: ${result.error}`, 'error');
                    }
                },
                
                openMiningInterface() {
                    window.open('mining-interface.html', '_blank');
                },
                
                openScannerInterface() {
                    window.open('scanner-interface.html', '_blank');
                },
                
                getNearbyMiningLocations() {
                    if (!window.miningSystem) return [];
                    
                    const locations = window.miningSystem.getAvailableLocations();
                    return Object.keys(locations).map(name => ({
                        name: name,
                        ...locations[name],
                        distance: this.calculateDistance(this.player.coordinates, locations[name].coordinates)
                    })).filter(loc => loc.distance <= 10).sort((a, b) => a.distance - b.distance);
                },
                
                getCargoUsed() {
                    if (!window.miningSystem) return 0;
                    return window.miningSystem.getCargoUsed('player1');
                },
                
                getMaxCargo() {
                    return 50; // Scout ship default
                },
                
                calculateDistance(pos1, pos2) {
                    return Math.sqrt(
                        Math.pow(pos1.x - pos2.x, 2) +
                        Math.pow(pos1.y - pos2.y, 2) +
                        Math.pow(pos1.z - pos2.z, 2)
                    );
                },
                
                // Refinery functions
                showRefineryOptions() {
                    this.currentView = {
                        title: 'üè≠ Refinery Station Construction',
                        content: `
                            <div class="space-y-6">
                                <div class="bg-gray-800 p-4 rounded-lg border border-purple-500">
                                    <h4 class="font-semibold text-purple-400 mb-3">üî® Build Level 1 Refinery Station</h4>
                                    <p class="text-gray-300 mb-4">A basic refinery station allows you to process raw ore into refined materials, increasing their market value.</p>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div class="bg-gray-700 p-3 rounded">
                                            <h5 class="text-blue-400 font-medium">üìä Specifications</h5>
                                            <ul class="text-sm text-gray-300 mt-2 space-y-1">
                                                <li>‚Ä¢ Processing Rate: 100 units/hour</li>
                                                <li>‚Ä¢ Efficiency: 1.5x value increase</li>
                                                <li>‚Ä¢ Compatible: Iron, Copper, Aluminum</li>
                                                <li>‚Ä¢ Build Time: 1 hour</li>
                                            </ul>
                                        </div>
                                        <div class="bg-gray-700 p-3 rounded">
                                            <h5 class="text-green-400 font-medium">üí∞ Economics</h5>
                                            <ul class="text-sm text-gray-300 mt-2 space-y-1">
                                                <li>‚Ä¢ Cost: 50,000 credits</li>
                                                <li>‚Ä¢ Operating Cost: 10 credits/hour</li>
                                                <li>‚Ä¢ Break-even: ~500 units</li>
                                                <li>‚Ä¢ ROI: 30-60 days</li>
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label class="block text-sm text-gray-300 mb-2">Select Construction Location:</label>
                                        <select id="refinery-location" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                            <option value="Keldar Planet">Keldar Planet (8 spots available)</option>
                                            <option value="Keldar Moon Alpha">Keldar Moon Alpha (3 spots available)</option>
                                            <option value="Keldar Moon Beta">Keldar Moon Beta (2 spots available)</option>
                                        </select>
                                    </div>
                                    
                                    <button onclick="window.stationAppInstance.buildRefinery()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-md">
                                        üî® Build Level 1 Refinery Station (50,000‚Çµ)
                                    </button>
                                </div>
                                
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h4 class="font-semibold text-orange-400 mb-3">üìà Refinery Benefits</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div class="text-center">
                                            <div class="text-2xl text-blue-400 mb-2">1.5x</div>
                                            <div class="text-sm text-gray-300">Value Multiplier</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-2xl text-green-400 mb-2">100</div>
                                            <div class="text-sm text-gray-300">Units/Hour</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-2xl text-purple-400 mb-2">‚àû</div>
                                            <div class="text-sm text-gray-300">Passive Income</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    };
                },
                
                buildRefinery() {
                    const location = document.getElementById('refinery-location')?.value || 'Keldar Planet';
                    
                    if (!this.player.credits || this.player.credits < 50000) {
                        this.showNotification('Insufficient credits! Need 50,000 credits to build refinery.', 'error');
                        return;
                    }
                    
                    if (!window.miningSystem) {
                        this.showNotification('Mining system not available', 'error');
                        return;
                    }
                    
                    const result = window.miningSystem.buildRefinery('player1', location, 'Basic Refinery');
                    if (result.success) {
                        this.player.credits -= result.cost;
                        this.savePlayer();
                        this.showNotification(`Refinery construction started at ${location}!`, 'success');
                        
                        this.currentView = {
                            title: 'üèóÔ∏è Refinery Under Construction',
                            content: `
                                <div class="bg-gray-800 p-6 rounded-lg border border-yellow-500">
                                    <h4 class="text-yellow-400 font-semibold mb-3">üöß Construction in Progress</h4>
                                    <p class="text-gray-300 mb-4">Your Level 1 Refinery Station is under construction at ${location}.</p>
                                    <div class="bg-gray-700 p-3 rounded mb-4">
                                        <div class="text-sm text-gray-300">Construction will complete in: <span class="text-blue-400">${Math.round(result.buildTime/1000)} seconds</span></div>
                                        <div class="w-full bg-gray-600 rounded-full h-2 mt-2">
                                            <div class="bg-yellow-500 h-2 rounded-full w-0 animate-pulse"></div>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-400">You will be notified when construction is complete.</p>
                                </div>
                            `
                        };
                    } else {
                        this.showNotification(`Construction failed: ${result.error}`, 'error');
                    }
                },
                
                processOre() {
                    if (!window.miningSystem) {
                        this.showNotification('Mining system not available', 'error');
                        return;
                    }
                    
                    const oreInventory = window.miningSystem.getPlayerInventory('player1');
                    
                    if (oreInventory.length === 0) {
                        this.showNotification('No ore to process! Mine some ore first.', 'error');
                        return;
                    }
                    
                    this.currentView = {
                        title: '‚öóÔ∏è Ore Processing Center',
                        content: `
                            <div class="space-y-4">
                                <div class="bg-gray-800 p-4 rounded-lg border border-orange-500">
                                    <h4 class="font-semibold text-orange-400 mb-3">üî¨ Level 1 Processing Available</h4>
                                    <p class="text-gray-300 mb-4">Basic ore refining increases value by 50% but requires processing time.</p>
                                    
                                    <div class="space-y-3">
                                        ${oreInventory.slice(0, 5).map(ore => `
                                            <div class="bg-gray-700 p-3 rounded flex justify-between items-center">
                                                <div>
                                                    <span class="text-white font-medium">${ore.amount}x ${ore.type}</span>
                                                    <span class="text-gray-400 text-sm ml-2">(${ore.quality})</span>
                                                </div>
                                                <div class="text-right">
                                                    ${ore.appraised ? 
                                                        `<div class="text-green-400">${ore.marketValue}‚Çµ ‚Üí ${Math.floor(ore.marketValue * 1.5)}‚Çµ</div>` :
                                                        `<div class="text-yellow-400">Appraise first</div>`
                                                    }
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                    
                                    <div class="mt-4 p-3 bg-blue-900 rounded">
                                        <p class="text-blue-300 text-sm">üí° Build a refinery station for automated processing and higher efficiency!</p>
                                    </div>
                                </div>
                            </div>
                        `
                    };
                },

                // COMPREHENSIVE SPECIALIST SYSTEM INTEGRATION
                initializeComprehensiveSpecialistSystem() {
                    try {
                        if (typeof ComprehensiveSpecialistSystem !== 'undefined') {
                            this.comprehensiveSystem = new ComprehensiveSpecialistSystem();
                            this.comprehensiveSystem.initialize(this.player);
                            console.log('Comprehensive Specialist System initialized successfully');
                        } else {
                            console.warn('Comprehensive Specialist System not available');
                        }
                    } catch (error) {
                        console.error('Failed to initialize Comprehensive Specialist System:', error);
                    }
                },

                // Quick access to specialist training from main interface
                showQuickTraining() {
                    if (!this.comprehensiveSystem) {
                        this.showNotification('Training system not available', 'error');
                        return;
                    }

                    const availableTutorials = this.comprehensiveSystem.tutorials.getAvailableTutorials(this.player);
                    const availableMissions = this.comprehensiveSystem.missions.generateAvailableMissions(this.player);
                    
                    this.currentView = {
                        title: 'üéì Quick Training Overview',
                        content: `
                            <div class="space-y-6">
                                <div class="text-center">
                                    <h3 class="text-xl font-bold text-yellow-400 mb-2">üåü Comprehensive Training Available</h3>
                                    <p class="text-gray-300">Access advanced tutorials, missions, and certification programs</p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-blue-900 bg-opacity-30 rounded-lg p-4 border border-blue-500">
                                        <h4 class="text-blue-400 font-semibold mb-2">üìö Tutorials Available</h4>
                                        <div class="text-2xl font-bold text-white mb-2">${availableTutorials.length}</div>
                                        <p class="text-blue-300 text-sm mb-3">Learn new skills</p>
                                        <a href="comprehensive-specialists.html" class="bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-sm inline-block w-full text-center">
                                            Start Learning
                                        </a>
                                    </div>
                                    
                                    <div class="bg-green-900 bg-opacity-30 rounded-lg p-4 border border-green-500">
                                        <h4 class="text-green-400 font-semibold mb-2">‚ö° Missions Ready</h4>
                                        <div class="text-2xl font-bold text-white mb-2">${availableMissions.length}</div>
                                        <p class="text-green-300 text-sm mb-3">Earn rewards</p>
                                        <a href="comprehensive-specialists.html?view=missions" class="bg-green-600 hover:bg-green-700 px-3 py-2 rounded text-sm inline-block w-full text-center">
                                            View Missions
                                        </a>
                                    </div>
                                    
                                    <div class="bg-purple-900 bg-opacity-30 rounded-lg p-4 border border-purple-500">
                                        <h4 class="text-purple-400 font-semibold mb-2">üèÜ Progress</h4>
                                        <div class="text-2xl font-bold text-white mb-2">${this.calculatePlayerLevel()}</div>
                                        <p class="text-purple-300 text-sm mb-3">Current level</p>
                                        <a href="comprehensive-specialists.html?view=achievements" class="bg-purple-600 hover:bg-purple-700 px-3 py-2 rounded text-sm inline-block w-full text-center">
                                            View Progress
                                        </a>
                                    </div>
                                </div>
                                
                                <div class="bg-gray-800 p-4 rounded-lg border border-yellow-500">
                                    <h4 class="text-yellow-400 font-semibold mb-3">üéØ Recommended Next Steps</h4>
                                    <div class="space-y-2">
                                        ${this.getRecommendedActions().map(action => `
                                            <div class="flex items-center justify-between bg-gray-700 p-3 rounded">
                                                <div>
                                                    <span class="text-white">${action.title}</span>
                                                    <div class="text-gray-400 text-sm">${action.description}</div>
                                                </div>
                                                <div class="text-yellow-400 text-sm">+${action.reputation} Rep</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `
                    };
                },

                calculatePlayerLevel() {
                    return Math.floor((this.player.reputation || 0) / 50) + 1;
                },

                getRecommendedActions() {
                    const actions = [];
                    const completed = this.player.specialistProgress?.tutorialsCompleted || [];
                    
                    if (!completed.includes('system_basics')) {
                        actions.push({
                            title: 'Complete System Orientation',
                            description: 'Learn about the Keldar system',
                            reputation: 25
                        });
                    }
                    
                    if (!completed.includes('navigation_basics')) {
                        actions.push({
                            title: 'Basic Navigation Training',
                            description: 'Master space travel fundamentals',
                            reputation: 35
                        });
                    }
                    
                    if (!completed.includes('scanner_basics')) {
                        actions.push({
                            title: 'Scanner Systems Training',
                            description: 'Learn to use all 5 scanner types',
                            reputation: 75
                        });
                    }
                    
                    return actions.slice(0, 3);
                },

                // Enhanced notification system with specialist integration
                showNotificationWithSpecialistTip(message, type = 'info', specialistTip = null) {
                    this.showNotification(message, type);
                    
                    if (specialistTip && this.comprehensiveSystem) {
                        setTimeout(() => {
                            this.showNotification(`üí° Tip: ${specialistTip}`, 'info');
                        }, 2000);
                    }
                },

                // Integration with existing scanner functions
                useSpatialScanner() {
                    if (!window.scannerSystem) {
                        this.showNotification('Scanner system not available', 'error');
                        return;
                    }
                    
                    const result = window.scannerSystem.startScan('spatial', 'stage1', this.player.coordinates);
                    if (result.success) {
                        this.currentView = {
                            title: 'üåå Spatial Scanner Active',
                            content: `<p class="text-blue-400">Spatial scan initiated...</p>
                                     <p class="text-gray-300">Scan duration: ${Math.round(result.duration/1000)} seconds</p>
                                     <p class="text-yellow-400">Energy consumed: 5 units</p>`
                        };
                        
                        // Check if player should learn about scanner training
                        const completed = this.player.specialistProgress?.tutorialsCompleted || [];
                        if (!completed.includes('scanner_basics')) {
                            this.showNotificationWithSpecialistTip(
                                'Spatial scan started', 
                                'success',
                                'Complete Scanner Training for improved efficiency and accuracy'
                            );
                        } else {
                            this.showNotification('Spatial scan started', 'success');
                        }
                    } else {
                        this.currentView = {
                            title: 'üåå Spatial Scanner Error',
                            content: `<p class="text-red-400">Scanner Error: ${result.error}</p>`
                        };
                        this.showNotification(result.error, 'error');
                    }
                },

                // Enhanced mining with specialist integration
                quickMine() {
                    if (!window.miningSystem) {
                        this.showNotification('Mining system not available', 'error');
                        return;
                    }
                    
                    const completed = this.player.specialistProgress?.tutorialsCompleted || [];
                    const certifications = this.player.specialistProgress?.certifications || [];
                    
                    // Check for proper training/certification
                    if (!completed.includes('mining_basics') && !certifications.includes('mining_operator')) {
                        this.showNotification('‚ö†Ô∏è Warning: Untrained mining detected! Consider completing mining tutorials.', 'warning');
                        
                        setTimeout(() => {
                            this.showNotification('üí° Visit Comprehensive Training for mining education', 'info');
                        }, 3000);
                    }
                    
                    // Try to mine at nearest location (Quilt Belt by default)
                    const result = window.miningSystem.startMining('player1', 
                        { type: 'Scout Ship', energy: 85 }, 
                        'Quilt Belt', 1);
                    
                    if (result.success) {
                        let message = result.message;
                        if (certifications.includes('mining_operator')) {
                            message += ' (Certified operator bonus applied)';
                        }
                        this.showNotification(message, 'success');
                        // Update view to show mining status
                        this.manageMining();
                    } else {
                        this.showNotification(`Mining failed: ${result.error}`, 'error');
                    }
                }
            }
        }

        // Initialize the app when Alpine.js loads
        document.addEventListener('alpine:init', () => {
            Alpine.data('stationApp', stationApp);
        });
    </script>
</body>
</html>
